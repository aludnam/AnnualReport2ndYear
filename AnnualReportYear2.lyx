#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass article
\begin_preamble
\usepackage{ccaption}
\captionnamefont{\bfseries}
\captiontitlefont{\small\sffamily\it}
\makeatletter


%\setcounter{page}{0} 
\numberwithin{equation}{section}
\numberwithin{figure}{section}
\numberwithin{table}{section}
%\date{}

\hyphenation{the-o-re-ti-cal}
\hyphenation{fluo-ro-pho-re}
\hyphenation{Fluo-ro-pho-re}
\hyphenation{fluo-res-cen-ce}
\hyphenation{Fluo-res-cen-ce}
\hyphenation{ma-the-ma-ti-cal}
\hyphenation{Ma-the-ma-ti-cal}
\hyphenation{in-ter-fero-met-er}
\hyphenation{ex-pe-ri-ment}
\hyphenation{pa-ra-me-ters}
\hyphenation{se-pa-ra-ted}
\hyphenation{exo-cy-to-sis}
\hyphenation{in-ves-ti-ga-ted}
\end_preamble
\use_default_options true
\maintain_unincluded_children false
\language british
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\float_placement !h
\paperfontsize 12
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_amsmath 1
\use_esint 1
\use_mhchem 1
\use_mathdots 1
\cite_engine basic
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2cm
\topmargin 1cm
\rightmargin 2cm
\bottommargin 1cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard

\lang english
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
homepath}{/Users/ondrejmandula}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
sfnpath}{/DTC/postersfn/Images}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
annreppath}{/DTC/annualreport/images}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
presimgpath}{/DTC/presentantios/images}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
qdotspath}{/project/data/qdots}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
spacedef}{10mm}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
sizea}{1.0}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
sizeb}{.8}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
sizec}{.6}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
sized}{.4}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
sizee}{.3}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
sizef}{.25}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
sizeg}{.2}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
sizeh}{.15}
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Title
Draft of the 2nd year review
\end_layout

\begin_layout Paragraph
\begin_inset Note Note
status open

\begin_layout Paragraph
Outline of the 2nd year review.
 
\end_layout

\begin_layout Plain Layout
(Underlined items have been already written or mentioned in the 1st year
 review.)
\end_layout

\begin_layout Plain Layout
Suggest a general intro re localisation microscopy, then work this year
 focusses on
\end_layout

\begin_layout Plain Layout
* GaP + DCA, plus variational GaP implementation.
\end_layout

\begin_layout Plain Layout
AFAIR, the main point of this was to deal better with model comparison.
\end_layout

\begin_layout Plain Layout
* FREM.
 Review of Ram et al 2006 and then the blinking question.
\end_layout

\begin_layout Plain Layout
* Results on determining optimal number of sources.
\end_layout

\begin_layout Plain Layout
* Real data isssue as in 4.3
\end_layout

\begin_layout Plain Layout
Then concl and future work directions.
\end_layout

\end_inset


\end_layout

\begin_layout Section
Outline & summary
\end_layout

\begin_layout Standard
The second year review report summarises work on my PhD project I have done
 since September 2010.
 It contains a short introduction to the problematics (Section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Model comparison"

\end_inset

) where the concept of the method is presented and put into context of the
 recent research.
 Section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Appendix Variational-approximation-for"

\end_inset

 contains some theoretical work on the model selection problematics.
\end_layout

\begin_layout Standard
The project has been presented on the SFN 2010 conference in San Diego.
\end_layout

\begin_layout Section
Introduction
\begin_inset CommandInset label
LatexCommand label
name "sec:Introduction"

\end_inset


\end_layout

\begin_layout Subsection
Localisation microscopy
\end_layout

\begin_layout Standard
Localisation microscopy (LM) provides a conceptually simple way to super-resolut
ion microscopy as a single source can be localised with an uncertainty much
 smaller then a classical Rayeigh's resolution criterion (approximately
 
\begin_inset Formula $\lambda_{em}/2$
\end_inset

, where 
\begin_inset Formula $\lambda_{em}$
\end_inset

 is an emission wavelength of the source 
\begin_inset CommandInset citation
LatexCommand cite
key "Rayleigh1896,Born1975principles"

\end_inset

).
 However, the Rayleigh criterion neglects the stochastic nature of the photon-de
tection process and does not take the total photon count (intensity of the
 source) into account.
 As shown in 
\begin_inset CommandInset citation
LatexCommand cite
key "Thompson2002,Ram2006"

\end_inset

 the variance of a single source localisation is inversely proportional
 to the number of photons we can collect from this source.
 For sufficiently intense sources the localisation precision can significantly
 surpass the Rayleigh resolution limit 
\begin_inset CommandInset citation
LatexCommand cite
key "Gordon2004,Qu2004,Lidke2005,Ober2004"

\end_inset

.
 
\end_layout

\begin_layout Subsection
PALM, STORM
\begin_inset CommandInset label
LatexCommand label
name "sub:PALM,-STORM"

\end_inset


\end_layout

\begin_layout Standard
In the real biological samples the sources are usually highly overlapping
 and can't be individually localised.
 PALM (Photo Activation Localisation Microscopy) 
\begin_inset CommandInset citation
LatexCommand cite
key "Hess2006"

\end_inset

 and STORM (STochastic Optical Resolution Microscopy) 
\begin_inset CommandInset citation
LatexCommand cite
key "Bates2007"

\end_inset

 are separating the individual sources by activating only a small subset
 of all sources.
 If the activated subset is small enough the individual fluorophores are
 well spatially separated and can be localised as individual sources.
 This requires an active control of the sources activation.
 It can be achieved either by using photo-activable (PA) fluorophores (PALM,
 STORM) or by reversive photo - bleaching 
\begin_inset CommandInset citation
LatexCommand cite
key "Baddeley2009"

\end_inset

.
 Repetition of this activation - localisation cycles can provide high resolution
 microscopy images of biological samples 
\begin_inset CommandInset citation
LatexCommand cite
key "Shroff2008,Huang2008"

\end_inset

.
\end_layout

\begin_layout Standard
Separation of individual emitters with overlapping PSFs from the statistical
 analysis of the recording of their blinking behaviour can also significantly
 speed the acquisition procedure (scaling inversely with the number of molecules
 localised per bright spot 
\begin_inset CommandInset citation
LatexCommand cite
key "Small2009"

\end_inset

).
\end_layout

\begin_layout Subsection
Quantum dots
\end_layout

\begin_layout Standard
Quantum dots (QD) represent fluorophores that are an order of magnitude
 brighter and several orders of magnitude more photo-bleaching resistant
 compared to the organic dyes used in LM 
\begin_inset CommandInset citation
LatexCommand cite
key "Jaiswal2004,Michalet2005"

\end_inset

.
 QDs also provide a wide absorption and a narrow excitation spectrum band.
 All these properties makes them very attractive for the biological research.
 Under a continuous excitation QDs exhibit a blinking behaviour (fluorescence
 intermittancy).
 They switch between “ON” episodes (
\begin_inset Formula $1/\tau_{\mathrm{ON}}^{m}$
\end_inset

) of a rapid absorption-fluorescence cycling and “OFF” episodes (
\begin_inset Formula $1/\tau_{\mathrm{OFF}}^{m}$
\end_inset

) where no light is emitted despite the continuous excitation.
 Both ON-time and OFF-time probability densities follow an inverse power
 law 
\begin_inset Formula $P(\tau_{\mathrm{ON/OFF}})\propto1/\tau_{\mathrm{ON/OFF}}^{m}$
\end_inset

 however, the blinking process is not yet fully understood 
\begin_inset CommandInset citation
LatexCommand cite
key "Kuno2001,Stefani2009"

\end_inset

.
 Despite all the advantages the QD can potentially provide, they are not
 suitable for the standard LM methods (PALM/STORM).
 The QD blinking behaviour is difficult to control and the overlapping sources
 cannot be separated and localised individually.
\end_layout

\begin_layout Subsection
Localisation microscopy using Quantum Dots
\end_layout

\begin_layout Standard
In 2005 there has been published a method exploiting the fluorescence intermitte
ncy ('blinking') of quantum dots under continuous excitation 
\begin_inset CommandInset citation
LatexCommand cite
key "Lidke2005"

\end_inset

.
 A time series of the blinking quantum dots was recorded and analysed using
 Independent Component Analysis (ICA).
 FastICA algorithm 
\begin_inset CommandInset citation
LatexCommand cite
key "Hyvarinen2000"

\end_inset

 has been used.
 As the blinking of the individual quantum dot is independent with respect
 to blinking of other quantum dots individual emitters even with overlapping
 PSFs can be separated.
\end_layout

\begin_layout Standard
Localisation of two quantum dots separated down to 23 nm (corresponding
 to 
\begin_inset Formula $\lambda_{\mathrm{em}}/30$
\end_inset

) has been reported 
\begin_inset CommandInset citation
LatexCommand cite
key "Lidke2005"

\end_inset

.
 Further exploration of the technique for more than two sources and for
 different configuration of the experiment can be found in 
\begin_inset CommandInset citation
LatexCommand cite
key "Lidke2007"

\end_inset

.
\end_layout

\begin_layout Standard
A Bayesian approach to the blinking of the individual fluorophores has been
 presented in poster in 2008 
\begin_inset CommandInset citation
LatexCommand cite
key "Harrington2008"

\end_inset

.
 A localisation of several quantum dots within the diffracted limited volume
 has been shown.
 
\end_layout

\begin_layout Standard
A method using the quantum dots for measurement of sub-resolution distances
 has been published in 
\begin_inset CommandInset citation
LatexCommand cite
key "Lagerholm2006"

\end_inset

.
 However, discrete ON-OFF blinking is required (only one source being ON
 and others OFF) as opposed to 
\begin_inset CommandInset citation
LatexCommand cite
key "Lidke2005,Harrington2008"

\end_inset

 where only fluctuation of the individual sources is needed.
\end_layout

\begin_layout Section
Motivation of the project
\begin_inset CommandInset label
LatexCommand label
name "sec:Motivation-of-the"

\end_inset


\end_layout

\begin_layout Standard
Non-negative matrix factorisation (NMF) seems to be a very natural method
 for dealing with the blinking QD data.
 The expectation value of noisy spatio-temporal 
\begin_inset Formula $N\times T$
\end_inset

 data matrix 
\begin_inset Formula $D$
\end_inset

 (
\begin_inset Formula $N$
\end_inset

 - total number of pixels, 
\begin_inset Formula $T$
\end_inset

 - number of time slices) is assumed to be decomposed into the 
\begin_inset Formula $N\times K$
\end_inset

 spatial component matrix 
\begin_inset Formula $W$
\end_inset

 (images of the individual sources) and the 
\begin_inset Formula $K\times T$
\end_inset

 temporal component matrix 
\begin_inset Formula $H$
\end_inset

 (intensities of the sources).
 
\begin_inset Formula 
\begin{equation}
\mathbb{E}\left[D\right]=\mathbb{E}\left[d_{xt}\right]=\left(WH\right)_{xt}=\sum_{k=1}^{K}w_{xk}h_{kt}\label{eq:NMF model}
\end{equation}

\end_inset

with non-negativity constraints 
\begin_inset Formula $d_{xt},\, w_{xk}\ \text{and}\ h_{kt}\geq0$
\end_inset

.
 
\end_layout

\begin_layout Standard
The NMF algorithm shown in 
\begin_inset CommandInset citation
LatexCommand cite
key "Lee2001"

\end_inset

 minimises the Kullback–Leibler (KL) divergence between the data and the
 model.
 It can be shown that this is equivalent to the maximisation log-likelihood
 function of the model Eq
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:NMF model"

\end_inset

 under the assumption of the Poisson noise (Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Appendix NMF-as-minimization"

\end_inset

).
 The details of the the algorithm are described in the first year review.
\end_layout

\begin_layout Section
Model comparison problem
\begin_inset CommandInset label
LatexCommand label
name "sec:Model comparison"

\end_inset


\end_layout

\begin_layout Standard
NMF requires a prior knowledge about the number of components to be separated
 (estimation of 
\begin_inset Formula $K$
\end_inset

 in Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:NMF model"

\end_inset

 - rank of the factorisation).
 For noise-free data it is possible to estimate the number of sources by
 analysing principal components (PC), for example.
 However, in the noisy case the rank estimation is difficult.
\end_layout

\begin_layout Standard
The standard NMF algorithm maximises the likelihood of the model Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:NMF model"

\end_inset

 under the assumption of the Poisson noise corrupted data.
 The likelihood function increases with higher 
\begin_inset Formula $K$
\end_inset

.
 The Bayesian Information Criterion (BIC) is a rough approximation of the
 Bayesian treatment penalising the complexity of the model.
 By evaluating the model for different values of 
\begin_inset Formula $K$
\end_inset

 we can compare the BIC score.
 However, as shown in the first year review the BIC might be too crude approxima
tion for the correct estimation of the data dimensionality.
 
\end_layout

\begin_layout Standard
A generative model underlying NMF is presented in section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Gamma-Poisson-(GaP)"

\end_inset

.
 A variational treatment of the problem (section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Variational-treatment-of"

\end_inset

) can provide a way to estimate the number of sources 
\begin_inset Formula $K$
\end_inset

 in the QD data.
 
\end_layout

\begin_layout Standard
A different approach to the model selection is shown in section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Analysis-of-the"

\end_inset

.
 Analysis of the correlations in residuals (data-model) is used to estimate
 the number of components 
\begin_inset Formula $K$
\end_inset

.
\end_layout

\begin_layout Subsection
Gamma Poisson (GaP) model 
\begin_inset CommandInset label
LatexCommand label
name "sub:Gamma-Poisson-(GaP)"

\end_inset


\end_layout

\begin_layout Standard
Gamma-Poisson (GaP) model 
\begin_inset CommandInset citation
LatexCommand cite
key "Canny2004"

\end_inset

 has been proposed as a probabilistic model for documents.
 It represents a generative probabilistic model for NMF Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:NMF model"

\end_inset

.
 The entries 
\begin_inset Formula $h_{kt}$
\end_inset

 (intensities of the sources) are treated as hidden variables generated
 from a Gamma distribution
\begin_inset Formula 
\[
p(h_{kt}|\alpha_{k},\beta_{k})=\frac{h_{kt}^{\alpha-1}\beta^{\alpha}\exp(-\beta h_{kt})}{\Gamma(\alpha)}
\]

\end_inset

and the data 
\begin_inset Formula $d_{xt}$
\end_inset

 modelled as a Poisson variable with mean 
\begin_inset Formula $\sum_{k}w_{xk}h_{kt}$
\end_inset

 
\begin_inset Formula 
\begin{equation}
p(d_{xt}|w_{xk},h_{kt})=\frac{\left(\sum_{k}w_{xk}h_{kt}\right)^{d_{xt}}\exp(-\sum_{k}w_{xk}h_{kt})}{d_{xt}!}\label{eq:GaP Poisson}
\end{equation}

\end_inset

where 
\begin_inset Formula $w_{xk}$
\end_inset

, 
\begin_inset Formula $\alpha_{k}$
\end_inset

 and 
\begin_inset Formula $\beta_{k}$
\end_inset

 are the parameters of the model.
 
\end_layout

\begin_layout Standard
The likelihood of the model is given by
\begin_inset Formula 
\begin{equation}
p(D,H|W,K,\theta)=\prod_{t=1}^{T}\prod_{k=1}^{K}p(h_{kt}|\alpha_{k},\beta_{k})\prod_{x=1}^{N}p(d_{xt}|W,H)\label{eq:GaP likelihood}
\end{equation}

\end_inset

and the log-likelihood
\begin_inset Formula 
\[
\log p(D,H|W,K,\theta)=\sum_{t=1}^{T}\left\{ \sum_{k=1}^{K}\log p(h_{kt}|\alpha_{k},\beta_{k})+\sum_{x=1}^{N}\log p(d_{xt}|W,H)\right\} 
\]

\end_inset

The coupling of the 
\begin_inset Formula $W$
\end_inset

 and 
\begin_inset Formula $H$
\end_inset

 in Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP Poisson"

\end_inset

 prevents from integrating out the hidden variables 
\begin_inset Formula $H$
\end_inset

 in Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP likelihood"

\end_inset

 
\begin_inset CommandInset citation
LatexCommand cite
key "Blei2003"

\end_inset

.
 This is problematic as in the expectation maximisation (EM) algorithm 
\begin_inset CommandInset citation
LatexCommand cite
key "Bishop2006"

\end_inset

 it is necessary to evaluate the term 
\begin_inset Formula $\mathbb{E}_{h_{kt}}\left[\log\sum_{k}w_{xk}h_{kt}\right]$
\end_inset


\begin_inset Formula $ $
\end_inset

.
 (In 
\begin_inset CommandInset citation
LatexCommand cite
key "Canny2004"

\end_inset

 a crude approximation is used 
\begin_inset Formula $\mathbb{E}_{h_{kt}}\left[\log\sum_{k}w_{xk}h_{kt}\right]\approx\log\mathbb{E}_{h_{kt}}\left[\sum_{k}w_{xk}h_{kt}\right]$
\end_inset

.)
\end_layout

\begin_layout Subsection
Variational treatment of the GaP model
\begin_inset CommandInset label
LatexCommand label
name "sub:Variational-treatment-of"

\end_inset


\end_layout

\begin_layout Standard
Variational treatment of the problem is proposed in 
\begin_inset CommandInset citation
LatexCommand cite
key "Buntine2006"

\end_inset

.
 The detailed derivation is provided in Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Appendix Variational-approximation-for"

\end_inset

.
 
\end_layout

\begin_layout Standard
A new latent 
\begin_inset Formula $N\times K$
\end_inset

 matrix 
\begin_inset Formula $V$
\end_inset

 (entries 
\begin_inset Formula $v_{xk}$
\end_inset

) is introduced such that
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\begin{alignedat}{1}\sum_{x=1}^{N}v_{xk}^{(t)} & =c_{k}^{(t)}\\
\sum_{k=1}^{K}v_{xk}^{(t)} & =d_{xt}
\end{alignedat}
\]

\end_inset

where the discrete latent vector 
\begin_inset Formula $c_{k}$
\end_inset

 gives the intensity of the 
\begin_inset Formula $k$
\end_inset

th component.
 The distribution of the underlying GaP model now becomes
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{1}
h_{kt} & \sim\mathrm{Gamma}(h_{kt};\alpha_{k},\beta_{k})\\
c_{k}^{(t)} & \sim\mathrm{Po}(c_{k}^{(t)};h_{kt})\\
v_{x,k}^{(t)} & \sim\mathrm{Multinom}(v_{xk}^{(t)};w_{xk},c_{k}^{(t)})
\end{alignat*}

\end_inset

and the likelihood of the GaP model with the latent matrix 
\begin_inset Formula $V$
\end_inset

 is then 
\begin_inset Formula 
\begin{alignat*}{1}
p(V,H|\alpha,\beta,W,K) & =\prod_{t=1}^{T}\prod_{k=1}^{K}p(h_{kt}|\alpha_{k},\beta_{k})\prod_{x=1}^{N}p(v_{1k}^{(t)},v_{2k}^{(t)}...v_{N,k}^{(t)}|h_{kt},w_{xk})\\
 & =\prod_{kt}\mathrm{Gamma}(h_{kt};\alpha_{k},\beta_{k})\prod_{x}\mathrm{Po}(c_{k}^{(t)};h_{kt})\times\mathrm{Multinom}(v_{xk}^{(t)};w_{xk},c_{k}^{(t)})
\end{alignat*}

\end_inset

explicitly 
\begin_inset Formula 
\begin{equation}
p(V,H|\alpha,\beta,W,K)=\prod_{kt}\frac{\beta_{k}^{\alpha_{k}}h_{kt}^{c_{k}^{(t)}+\alpha_{k}-1}\exp(-(\beta_{k}+1)h_{kt})}{\Gamma(\alpha_{k})}\prod_{x}\frac{w_{xk}^{v_{xk}^{(t)}}}{v_{xk}^{(t)}!}\label{eq:GaP likelihood with latent matrix V}
\end{equation}

\end_inset

 
\begin_inset Formula $D$
\end_inset

 is derived from 
\begin_inset Formula $V$
\end_inset

 (
\begin_inset Formula $d_{xt}=\sum_{k}v_{xk}^{(t)}$
\end_inset

) so it is not represented.
\end_layout

\begin_layout Standard
A factored posterior approximation is made for the latent variable to find
 expectations as part of an optimisation step.
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
p(V,H|\alpha,\beta,W,K)\approx q(V,H)=q_{V}(V)q_{H}(H)\label{eq:GaP factorised approximation}
\end{equation}

\end_inset

where the optimal solution is given by 
\begin_inset CommandInset citation
LatexCommand cite
key "Bishop2006"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{1}
\log q_{H}^{*}(H) & =\mathbb{E}_{V\sim q_{V}}\left[\log p(V,H,D|W,\alpha,\beta)\right]+\mathrm{const}\\
\log q_{V}^{*}(V) & =\mathbb{E}_{H\sim q_{H}}\left[\log p(V,H,D|W,\alpha,\beta)\right]+\mathrm{const}
\end{alignat*}

\end_inset

The likelihood of the data is bounded by
\begin_inset Formula 
\[
p(D|W,\alpha,\beta)\geq\mathcal{L}(q,W,\alpha,\beta)
\]

\end_inset

where
\begin_inset Note Note
status open

\begin_layout Plain Layout
This is the problematic integral ---> this expectation value...
 => variational approximation....
\end_layout

\end_inset

 
\begin_inset Formula 
\begin{equation}
\mathcal{L}(q,W,\alpha,\beta)=\mathbb{E}_{V,H\sim q(V,H)}\left[\log p(H,V,D|W,\alpha,\beta,K)\right]+C\label{eq:GaP Lower bound}
\end{equation}

\end_inset

is a variational lower bound 
\begin_inset CommandInset citation
LatexCommand cite
key "Bishop2006"

\end_inset

 and the 
\begin_inset Formula $C$
\end_inset

 contains the entropy terms of 
\begin_inset Formula $q_{H}$
\end_inset

 and 
\begin_inset Formula $q_{V}$
\end_inset

 which are constant wrt 
\begin_inset Formula $W$
\end_inset

.
\end_layout

\begin_layout Standard
The factorised form Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP factorised approximation"

\end_inset

 and the likelihood Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP likelihood with latent matrix V"

\end_inset

 suggest
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{1}
q_{H}(H) & =\prod_{k}\mathrm{Gamma}(h_{kt};a_{k}^{(t)},b_{k})\\
q_{V}(V) & =\prod_{xk}\mathrm{Mutlinom}(v_{xk}^{(t)};n_{xk}^{(t)},d_{x})
\end{alignat*}

\end_inset

and the update rules for the parameters 
\begin_inset Formula $n_{xk}$
\end_inset

, 
\begin_inset Formula $a_{k}$
\end_inset

 and 
\begin_inset Formula $b_{k}$
\end_inset

 can be derived (for details see Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Variational-Approximation"

\end_inset

)
\begin_inset Formula 
\begin{alignat}{1}
n_{xk}^{(t)} & =\frac{1}{z_{x}}W_{xk}\exp(\psi_{0}(a_{k}^{(t)})-\log b_{k})\nonumber \\
a_{k}^{(t)} & =\sum_{x=1}^{N}n_{xk}^{(t)}d_{xt}+\alpha_{k}\label{eq:GaP update rules}\\
b_{k} & =1+\beta_{k}\nonumber 
\end{alignat}

\end_inset

where 
\begin_inset Formula $z_{x}$
\end_inset

 is the normalisation constant 
\begin_inset Formula $z_{x}=\sum_{k}n_{xk}$
\end_inset

.
 
\begin_inset Formula $\psi_{0}$
\end_inset

 is digamma function (logarithmic derivation of the gamma function).
 
\end_layout

\begin_layout Standard
By maximising the lower bound Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP Lower bound"

\end_inset

 wrt 
\begin_inset Formula $w_{xk}$
\end_inset


\begin_inset Formula 
\begin{equation}
w_{xk}=\frac{\sum_{t}n_{xk}^{(t)}d_{xt}}{\lambda_{k}}\label{eq:GaP update W}
\end{equation}

\end_inset

where 
\begin_inset Formula $\lambda_{k}=\sum_{x}w_{xk}$
\end_inset

 is the normalisation constant.
\end_layout

\begin_layout Standard
The variational lower bound on the log-likelihood Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP Lower bound"

\end_inset

 then becomes 
\begin_inset Formula 
\begin{equation}
\mathcal{L}=\sum_{t}\left\{ \sum_{k}\mathbb{E}_{H}\left[\log h_{kt}\right](\alpha_{k}-a_{k}^{(t)})+\sum_{k}\log\frac{\Gamma(a_{k}^{(t)})\beta_{k}^{\alpha_{k}}}{\Gamma(\alpha_{k})b_{k}^{a_{k}^{(t)}}}+\sum_{x}d_{xt}\log z_{x}-\log\prod_{x}d_{xt}!\right\} \label{eq:GaP variational lower bound}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float algorithm
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
Repeat until convergence:
\end_layout

\begin_layout Enumerate
For each time slice 
\begin_inset Formula $t$
\end_inset

 of the stack: update 
\begin_inset Formula $n_{xk}^{(t)}$
\end_inset

 and 
\begin_inset Formula $a_{k}^{(t)}$
\end_inset

 according to Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP update rules"

\end_inset

.
 (Variational E step)
\end_layout

\begin_layout Enumerate
Update 
\begin_inset Formula $W$
\end_inset

 according to the Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP update W"

\end_inset

.
 (Variational M step.)
\end_layout

\begin_layout Enumerate
Compute the variational lower bound Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP variational lower bound"

\end_inset

 and check for convergence.
 
\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Algorithm for the variational approximation updates.
\end_layout

\end_inset


\end_layout

\end_inset

These updates have been implemented in MATLAB.
 
\end_layout

\begin_layout Standard
GaP model treats the intensities 
\begin_inset Formula $h_{kt}$
\end_inset

 as hidden variables.
 The Variational lower bound Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP Lower bound"

\end_inset

 bounds the approximate of the likelihood of the GaP model integrated over
 the hidden variables 
\begin_inset Formula $h_{kt}$
\end_inset

 Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:GaP factorised approximation"

\end_inset

.
  It then naturally penalises the complexity of the model (Occam’s razor
 
\begin_inset CommandInset citation
LatexCommand cite
key "MacKay2003"

\end_inset

) and can then be used for estimation of the 
\begin_inset Formula $K$
\end_inset

.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
Needs some revision!!!
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Analysis of the residuals
\begin_inset CommandInset label
LatexCommand label
name "sub:Analysis-of-the"

\end_inset


\end_layout

\begin_layout Standard
Different approach to the number of components 
\begin_inset Formula $K$
\end_inset

 estimation is to analyse the 
\begin_inset Formula $N\times T$
\end_inset

 residual matrix 
\begin_inset Formula $\bm{S}$
\end_inset

 (entries 
\begin_inset Formula $s_{xt}$
\end_inset

).
 After optimising the parameters of the model Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:NMF model"

\end_inset

 for different number of 
\begin_inset Formula $K$
\end_inset

 we compute a normalised residual matrix 
\begin_inset Formula 
\[
s_{xt}=\frac{d_{xt}-\sum_{k=1}^{K}w_{xk}h_{kt}}{\sum_{k=1}^{K}w_{xk}h_{kt}}
\]

\end_inset

Then the 
\begin_inset Formula $N\times N$
\end_inset

 correlation matrix 
\begin_inset Formula 
\[
\bm{C}_{S}=\bm{SS}^{T}
\]

\end_inset

and the 
\begin_inset Formula $N\times N$
\end_inset

 matrix of the correlation coefficients 
\begin_inset Formula $ $
\end_inset


\begin_inset Formula $\bm{R}_{S}$
\end_inset

 with entries 
\begin_inset Formula 
\begin{equation}
r_{ij}=\frac{c_{ij}}{\sqrt{c_{ii}c_{jj}}}\label{eq:Correlation in residuals}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Underestimation of the number of sources (
\begin_inset Formula $K$
\end_inset

 too small) will lead to correlations between some pixels the model will
 try to explain the multiple sources by one object.
 By increasing 
\begin_inset Formula $K$
\end_inset

 the correlations should be gradually decreasing until we have sufficient
 number of sources to explain the data and the residuals become uncorrelated.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Itemize
model comparison (compare with BIC...)
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Results
\end_layout

\begin_layout Standard
In the following section simulated data of 10 sources randomly spatially
 distributed are shown.
 Evaluation of the model with a classic NMF algorithm and the variational
 approximation is shown.
 
\begin_inset Formula $K$
\end_inset

 was varied in the range 
\begin_inset Formula $K=\{4,\,5,\,6\ ...\ 17\}$
\end_inset

.
 
\end_layout

\begin_layout Standard
Data were simulated according to a model Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:NMF model"

\end_inset

 with parameter set to values shown in Table
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Parameters-of-the-simulation"

\end_inset

: 
\end_layout

\begin_layout Enumerate
\begin_inset Formula $K_{true}=10$
\end_inset

 spatial coordinates 
\begin_inset Formula $[x_{k},\, y_{k}]$
\end_inset

 confined to a circular region of with a radius 
\begin_inset Formula $\delta$
\end_inset

 were generated (
\begin_inset Formula $x$
\end_inset

 and 
\begin_inset Formula $y$
\end_inset

 coordinates generated from a uniform distribution subject to a spatial
 constraint to a circular area).
 
\begin_inset Formula $\delta$
\end_inset

 was equal to the Rayleigh's resolution limit.
\end_layout

\begin_layout Enumerate
In focus PSF was centred at each generated coordinate (
\begin_inset Formula $W$
\end_inset

 in Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:NMF model"

\end_inset

).
\end_layout

\begin_layout Enumerate
Intensities of the individual sources over time 
\begin_inset Formula $h_{kt}$
\end_inset

 were generated from a uniform distribution in a region 
\begin_inset Formula $h_{kt}=\{0,\,1,\,2\ ...\ I_{max}\}$
\end_inset

 where 
\begin_inset Formula $I_{max}$
\end_inset

 is the maximum intensity of the 
\begin_inset Formula $k$
\end_inset

th source.
\end_layout

\begin_layout Enumerate
A homogeneous background of 
\begin_inset Formula $b$
\end_inset

 was added to each frame of the time sequence
\end_layout

\begin_layout Enumerate
Poisson noise was added to this data
\end_layout

\begin_layout Standard
Data with lower density of the sources were simulated in a same way.
 However the relative distance between sources locations 
\begin_inset Formula $[x_{k},\, y_{k}]$
\end_inset

 (generated in the step 1) were enlarged 
\begin_inset Formula $1.5\times$
\end_inset

 and 
\begin_inset Formula $2.5\times$
\end_inset

.
 This way the geometrical configuration of the sources remains the same
 for all data sets.
 The locations of the sources are shown as blue circles in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - Simulated-data"

\end_inset

 the circle with the radius 
\begin_inset Formula $\delta$
\end_inset

 is shown in green.
 The mean intensity image (
\begin_inset Formula $\frac{1}{T}\sum_{t}d_{xt}$
\end_inset

 - time sequence of QDs averaged over time) is shown in as grey scale image.
 
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="9" columns="3">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Parameter
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Value
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Description
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $T$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $10^{3}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Number of time slices in the sequence
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $K_{true}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $10$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Number of sources in the simulated data
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $10^{2}$
\end_inset

 photons
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Uniform background added to each time slice
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $I_{max}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.5\cdot10^{3}$
\end_inset

 photons
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Maximum intensity of a single source in one time slice
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\lambda_{em}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $655\ \text{nm}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Emission wavelength
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $NA$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1.2$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Numerical aperture of the objective
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
pixel-size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $106$
\end_inset

 nm
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Size of a pixel in the sample plane
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\delta$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $333\,\text{nm}$
\end_inset

 (
\begin_inset Formula $3.1$
\end_inset

 pixels)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Radius of the region containing the sources (
\begin_inset Formula $\delta=0.61\frac{\lambda_{em}}{NA}$
\end_inset

)
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Parameters of the simulation
\begin_inset CommandInset label
LatexCommand label
name "tab:Parameters-of-the-simulation"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S275/images/data_meanpad}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
s
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S274/images/data_meanpad}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
b
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S270/images/data_meanpad}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
c
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Simulated data - 10 sources in focus with different density
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizea]{
\backslash
homepath 
\backslash
qdotspath /S275/images/reswpad_col1}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizea]{
\backslash
homepath 
\backslash
qdotspath /S275/images/reswpad_col2}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
a
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hspace{
\backslash
spacedef}
\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizea]{
\backslash
homepath 
\backslash
qdotspath /S277/images/reswpad_col1}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizea]{
\backslash
homepath 
\backslash
qdotspath /S277/images/reswpad_col2}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
b
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
hspace{
\backslash
spacedef}
\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizea]{
\backslash
homepath 
\backslash
qdotspath /S273/images/reswpad_col1}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizea]{
\backslash
homepath 
\backslash
qdotspath /S273/images/reswpad_col2}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
c
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
Separated 
\begin_inset Formula $W_{xk}$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
ima}{$2.5
\backslash
delta$} 
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
imb}{$1.5
\backslash
delta$}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
imc}{$
\backslash
delta$}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
pca}{, PCA}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
llk}{, log-likelihood}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
lbd}{, lower bound}
\end_layout

\begin_layout Plain Layout


\backslash
newcommand{
\backslash
mxc}{, maximum correlation}
\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S275/images/reslocalized_nc11}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ima
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:simulations 2.5 delta "

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S277/images/reslocalized_nc11}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imb
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:simulations 1.5 delta "

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S273/images/reslocalized_nc11}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imc
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:simulations 1 delta "

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Simulated data (10 sources) with different densities.
 Sources in all three figures have the same geometrical configuration but
 different relative distances between the centres so that they are contained
 in the circular area with radius 
\begin_inset Formula $2.5\delta$
\end_inset

 (
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:simulations 2.5 delta "

\end_inset

), 
\begin_inset Formula $1.5\delta$
\end_inset

 (
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:simulations 1.5 delta "

\end_inset

) and 
\begin_inset Formula $\delta$
\end_inset

 (
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:simulations 1 delta "

\end_inset

).
 Mean intensity over time is shown as a grey scale image.
 The true positions of the sources are shown as blue circles, estimated
 positions as red crosses.
 Green circle indicates a circular area with radius 
\begin_inset Formula $\delta$
\end_inset

.
\begin_inset CommandInset label
LatexCommand label
name "fig:K estimation - Simulated-data"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

Principal component analysis (PCA) for the simulated data is shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - pca,loglik,lowerboudn,correl"

\end_inset

a-c where the first 20 PC eigenvalues are plotted.
 For the the dataset 
\begin_inset Formula $2.5\delta$
\end_inset

 (Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - pca,loglik,lowerboudn,correl"

\end_inset

a) we observe a distinct 'kink' and for 
\begin_inset Formula $k>10$
\end_inset

 the PC values are negligible.
 For this dataset it is easy to estimate the 
\begin_inset Formula $K$
\end_inset

 from this simple analysis.
 However when the density of the points becomes higher the 'kink' is much
 less pronounced (Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - pca,loglik,lowerboudn,correl"

\end_inset

b-c) and the estimation of the 
\begin_inset Formula $K$
\end_inset

 from the PCA becomes difficult.
 
\end_layout

\begin_layout Standard
We used NMF updates 
\begin_inset CommandInset citation
LatexCommand cite
key "Lee2001"

\end_inset


\begin_inset Formula 
\begin{alignat}{1}
w_{xk} & =\frac{w_{xk}}{\sum_{t=1}^{T}h_{kt}}\left[(D./WH)H^{\top}\right]_{xk}\nonumber \\
h_{kt} & =\frac{h_{kt}}{\sum_{x=1}^{N}w_{xk}}\left[W^{\top}(D./WH)\right]_{kt}\label{eq:NMF updates Lee 2001}
\end{alignat}

\end_inset

to estimate the non-negative matrices 
\begin_inset Formula $W$
\end_inset

 (images of the individual sources) and 
\begin_inset Formula $H$
\end_inset

 (their intensities) of the model Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:NMF model"

\end_inset

.
 The 
\begin_inset Formula $./$
\end_inset

 operation in refers to element-wise division.
 Different values of 
\begin_inset Formula $K=\{4,5,\,...\,18\}$
\end_inset

 were used and the log-likelihood 
\begin_inset Formula 
\[
\log p(D|WH,K)=\sum_{x,t}\left\{ d_{xt}\log\sum_{k=1}^{K}w_{xk}h_{kt}-\sum_{k=1}^{K}w_{xk}h_{kt}-\log d_{xt}!\right\} 
\]

\end_inset

has been reported (Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - pca,loglik,lowerboudn,correl"

\end_inset

d-f).
 We observe an increase of the likelihood function with increasing 
\begin_inset Formula $K$
\end_inset

 which is not surprising as there is no penalisation for the model complexity.
 The estimated position of the separated sources (
\begin_inset Formula $W$
\end_inset

) with 
\begin_inset Formula $K=K_{true}$
\end_inset

 is shown as blue circles in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - Simulated-data"

\end_inset


\end_layout

\begin_layout Standard
We analysed the correlation-coeefficient matrix 
\begin_inset Formula $\bm{R}_{S}$
\end_inset

 for the residuals Eq
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Correlation in residuals"

\end_inset

 and plotted the maximum entries in 
\begin_inset Formula $\bm{R}_{S}$
\end_inset

 in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:K estimation - pca,loglik,lowerboudn,correl"

\end_inset

g-i.
 There is a significant drop in the correlation values for 
\begin_inset Formula $K=10$
\end_inset

 for the first two datasets.
 For the densest data the correlations drop at about 
\begin_inset Formula $K=8$
\end_inset

 (Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - pca,loglik,lowerboudn,correl"

\end_inset

i).
\end_layout

\begin_layout Standard
In Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - pca,loglik,lowerboudn,correl"

\end_inset

j-l there is shown a variational lower bound 
\begin_inset Formula $\mathcal{L}(K)$
\end_inset

 computed for the GaP with different values of 
\begin_inset Formula $K$
\end_inset

 according to section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Variational-treatment-of"

\end_inset

.
 For the easy (sparse) data set Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:simulations 2.5 delta "

\end_inset

 
\begin_inset Formula $\mathcal{L}(K)$
\end_inset

 peaks for 
\begin_inset Formula $K=K_{true}$
\end_inset

 (Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - pca,loglik,lowerboudn,correl"

\end_inset

j) however, for the more dense data 
\begin_inset Formula $\mathcal{L}(K)$
\end_inset

 reaches the maximum for 
\begin_inset Formula $K<K_{true}$
\end_inset

.
 This suggest that for dense data sets there is not enough evidence in the
 data for the correct estimation of the 
\begin_inset Formula $K$
\end_inset

 as the data can be sufficiently explained with less complicated model (less
 sources are explaining data equally well).
 Its probably worth emphasising that GaP model does not make any assumption
 about the time structure of the hidden variables 
\begin_inset Formula $h_{kt}$
\end_inset

.
 This information can provide a crucial evidence for the correct estimation
 of 
\begin_inset Formula $K$
\end_inset

.
\begin_inset Formula 
\begin{alignat*}{1}
\end{alignat*}

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S275/images/pca}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ima 
\backslash
pca
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S274/images/pca}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imb 
\backslash
pca
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S270/images/pca}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imc 
\backslash
pca
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S275/images/LogLikPoisson}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ima 
\backslash
llk
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S274/images/LogLikPoisson}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imb 
\backslash
llk
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S270/images/LogLikPoisson}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imc 
\backslash
llk
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Note Note
status open

\begin_layout Plain Layout
These are results from the nmf initialized from the var updates.
 Somehow smoother curves...
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S275/images/MaxCorrInResid_min2}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ima 
\backslash
mxc
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S277/images/MaxCorrInResid_min2}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imb 
\backslash
mxc
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S273/images/MaxCorrInResid_min2}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imc 
\backslash
mxc
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S275/images/LowerBound}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ima 
\backslash
lbd
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S274/images/LowerBound}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imb 
\backslash
lbd
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizee]{
\backslash
homepath 
\backslash
qdotspath /S270/images/LowerBound}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imc 
\backslash
lbd
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Number of components 
\begin_inset Formula $K$
\end_inset

 estimation for sources contained in the circular area with radius 
\begin_inset Formula $2.5\delta$
\end_inset

 (left column), 
\begin_inset Formula $1.5\delta$
\end_inset

 (middle column) and 
\begin_inset Formula $\delta$
\end_inset

 (right column) as shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:K estimation - Simulated-data"

\end_inset

.
 The true value 
\begin_inset Formula $K_{true}=10$
\end_inset

 is indicated with a red vertical line.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:K estimation - pca,loglik,lowerboudn,correl"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Itemize
Log likelihood
\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizef]{
\backslash
homepath 
\backslash
qdotspath /S275/images/LogLikPoisson}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizef]{
\backslash
homepath 
\backslash
qdotspath /S274/images/LogLikPoisson}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizef]{
\backslash
homepath 
\backslash
qdotspath /S270/images/LogLikPoisson}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Itemize
Variational lower bound [Buntine & Jakulin, 2006]
\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizef]{
\backslash
homepath 
\backslash
qdotspath /S275/images/LowerBound}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizef]{
\backslash
homepath 
\backslash
qdotspath /S274/images/LowerBound}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizef]{
\backslash
homepath 
\backslash
qdotspath /S270/images/LowerBound}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Itemize
Correlations in residuals (data - model)
\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Note Note
status open

\begin_layout Plain Layout
These are results from the nmf initialized from the var updates.
 Somehow smoother curves...
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizef]{
\backslash
homepath 
\backslash
qdotspath /S275/images/MaxCorrInResid_min}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizef]{
\backslash
homepath 
\backslash
qdotspath /S277/images/MaxCorrInResid_min}
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizef]{
\backslash
homepath 
\backslash
qdotspath /S273/images/MaxCorrInResid_min}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Theoretical limits of the LM
\end_layout

\begin_layout Standard
Results from the variational approximation naturally bring a question about
 actual limits of the LM method.
 How close the sources can be in order to be possible to resolve them with
 the LM method? What are the limiting factors? The Rayleigh's resolution
 criterion 
\begin_inset CommandInset citation
LatexCommand cite
key "Rayleigh1896,Born1975principles"

\end_inset

 neglects the stochastic nature of the photon-detection process and does
 not take the total photon count (intensity of the source) into account.
 As shown in 
\begin_inset CommandInset citation
LatexCommand cite
key "Thompson2002,Ram2006"

\end_inset

 the variance of a single source localisation is inversely proportional
 to the number of photons we can collect from this source.
 For sufficiently intense sources the localisation precision can significantly
 surpass the Rayleigh resolution limit 
\begin_inset CommandInset citation
LatexCommand cite
key "Gordon2004,Qu2004,Lidke2005,Ober2004"

\end_inset

.
 
\end_layout

\begin_layout Subsection
Cramer Rao bound
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
some notes on cramer rao lower bound
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Fundamental resolution measure (FREM)
\end_layout

\begin_layout Standard
For PALM/STORM (section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:PALM,-STORM"

\end_inset

) the spatial resolution limit is determined by the localisation precision
 for an individual source.
 Cramér–Rao bound 
\begin_inset CommandInset citation
LatexCommand cite
key "Rao1945"

\end_inset

 for the position estimation of a single source detected by a CCD camera
 is derived in 
\begin_inset CommandInset citation
LatexCommand cite
key "Ram2006b"

\end_inset

.
 The variance of the position estimator is shown to be proportional to 
\begin_inset Formula $\frac{1}{\Lambda}$
\end_inset

 where 
\begin_inset Formula $\Lambda$
\end_inset

 is the intensity of the source.
\end_layout

\begin_layout Standard
A fundamental resolution measure for two sources separated by a distance
 
\begin_inset Formula $d$
\end_inset

 is shown in 
\begin_inset CommandInset citation
LatexCommand cite
key "Ram2006"

\end_inset

 as an alternative to the Rayleigh's resolution criterion considering the
 photon statistic on the detector (CCD camera).
 The Fisher information is shown to be 
\begin_inset Formula 
\begin{equation}
I(d)=\frac{1}{4}\sum_{n=1}^{N}\frac{\left(\Lambda_{1}\int_{C_{n}}\partial_{x}q(x-\frac{d}{2})dx-\Lambda_{2}\int_{C_{n}}\partial_{x}q(x+\frac{d}{2})dx\right)^{2}}{\Lambda_{1}\int_{C_{n}}q(x-\frac{d}{2})dx+\Lambda_{2}\int_{C_{n}}q(x+\frac{d}{2})dx}\label{eq:Ram FREM}
\end{equation}

\end_inset

where 
\begin_inset Formula $\Lambda_{i}$
\end_inset

 is the intensity of the 
\begin_inset Formula $i$
\end_inset

th source, 
\begin_inset Formula $q(x)$
\end_inset

 is a response function of a source and 
\begin_inset Formula $C_{n}$
\end_inset

 is an area of the 
\begin_inset Formula $n$
\end_inset

th pixel.
 A short summary is shown in Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Appendix Two-sources-separated"

\end_inset

.
 There are certain issues with this formula.
 Form the limit 
\begin_inset Formula $d\rightarrow0$
\end_inset

 the Fisher information 
\begin_inset Formula $I(d)\rightarrow0$
\end_inset

 (so the variance 
\begin_inset Formula $\text{var}(d)\rightarrow\infty$
\end_inset

) for situation when 
\begin_inset Formula $\Lambda_{1}=\Lambda_{2}$
\end_inset

.
 However, the variance remains finite (
\begin_inset Formula $I(d)\neq0$
\end_inset

) when 
\begin_inset Formula $\Lambda_{1}\neq\Lambda_{2}$
\end_inset

 (see discussion in Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Appendix Two-sources-separated"

\end_inset

).
 The formula also gives 
\begin_inset Formula $I(d)\neq0$
\end_inset

 even for the situation when one of the sources is not present (
\begin_inset Formula $\Lambda_{i}=0$
\end_inset

).
 This problem stems from the fact that the response function of the sources
 are located at 
\begin_inset Formula $\pm\frac{d}{2}$
\end_inset

 which implicitly assumes the knowledge of the origin location.
 Only one source is then needs to determined the distance 
\begin_inset Formula $\frac{d}{2}$
\end_inset

.
\end_layout

\begin_layout Subsection
An alternative derivation of the FREM
\begin_inset CommandInset label
LatexCommand label
name "sub:An-alternative-derivation-FREM"

\end_inset


\end_layout

\begin_layout Standard
We derived an alternative FREM formula for two sources (Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Appendix An-alternative-way-Fisher-info"

\end_inset

).
 We assume two sources located at position 
\begin_inset Formula $c_{1}$
\end_inset

 and 
\begin_inset Formula $c_{2}$
\end_inset

.
 Then the response function (we assume here the identical response functions
 for both sources) are 
\begin_inset Formula $f_{1}=q(x-c_{1})$
\end_inset

 and 
\begin_inset Formula $f_{2}=q(x-c_{2})$
\end_inset

.
 The distance between the two sources is 
\begin_inset Formula $d=c_{1}-c_{2}$
\end_inset

 and the variance of 
\begin_inset Formula $d$
\end_inset

 is given by 
\begin_inset Formula 
\[
\textrm{var}(d)=Q_{11}+Q_{22}-2Q_{12}
\]

\end_inset

 where 
\begin_inset Formula $\bm{Q}$
\end_inset

 is a covariance matrix 
\begin_inset Formula $\bm{Q}=\bm{I}^{-1}(\theta)$
\end_inset

 and 
\begin_inset Formula $\bm{I}(\theta)$
\end_inset

 is the (symmetric) Fisher information matrix
\begin_inset Formula 
\begin{equation}
I_{ij}(\bm{\theta})=-\mathbb{E}\left[\frac{\partial^{2}\mathcal{L}}{\partial\theta_{i}\partial\theta_{j}}\right]=\mathbb{E}\left[\frac{\partial\mathcal{L}}{\partial\theta_{i}}\frac{\partial\mathcal{L}}{\partial\theta_{j}}\right]\label{eq:Fisher information general}
\end{equation}

\end_inset

where 
\begin_inset Formula $\mathcal{L}(\theta)=\log p(x|\theta)$
\end_inset

 is a log-likelihood function.
 For a Poisson distributed pixel counts (this assumes that data are corrupted
 with Poisson noise only) 
\begin_inset Formula 
\[
p(n_{p}|\theta_{p})=\text{Po}(n_{p};\lambda_{p})
\]

\end_inset

where 
\begin_inset Formula $\lambda_{p}$
\end_inset

 is the mean value of the 
\begin_inset Formula $p$
\end_inset

th pixel:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\lambda_{p}=\int_{C_{p}}\lambda dx=\int_{C_{p}}\Lambda_{1}f_{1}(x)+\Lambda_{2}f_{2}(x)dx\label{eq:Mean value of hte Poisson process}
\end{equation}

\end_inset

The log-likelihood function for 
\begin_inset Formula $N$
\end_inset

 pixels
\begin_inset Formula 
\begin{equation}
\log p(n|\theta)=\sum_{p=1}^{N}p(n_{p}|\lambda_{p})\label{eq:FREM likekihood Poisson}
\end{equation}

\end_inset

and the Fisher information matrix becomes (Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub: Appendix Fisher-Information-Poisson"

\end_inset

) 
\begin_inset Formula 
\[
I_{ij}(\theta)=\sum_{p=1}^{N}\frac{1}{\lambda_{p}}\frac{\partial\lambda_{p}}{\partial\theta_{i}}\frac{\partial\lambda_{p}}{\partial\theta_{j}}
\]

\end_inset

The covariance matrix 
\begin_inset Formula $\bm{Q}$
\end_inset

 is then 
\begin_inset Formula 
\[
\bm{Q}=\bm{I}^{-1}(\theta)=\frac{1}{I_{11}I_{12}-I_{12}^{2}}\left(\begin{array}{cc}
I_{22} & -I_{12}\\
-I_{12} & I_{11}
\end{array}\right)
\]

\end_inset

and the variance of 
\begin_inset Formula $d=c_{1}-c_{2}$
\end_inset

 
\begin_inset Formula 
\begin{equation}
\textrm{var}(d)=(1,-1)^{T}\cdot\bm{Q}\cdot(1,-1)=\frac{I_{11}+I_{22}+2I_{12}}{I_{11}I_{12}-I_{12}^{2}}\label{eq:variance d alternative}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
For a symmetrical PSF 
\begin_inset Formula $q(x-d)=q(x+d)$
\end_inset

 we showed (Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub: Appendix Fisher-Information-Poisson"

\end_inset

) the entries of the Fisher information matrix
\begin_inset Formula 
\begin{alignat}{2}
I_{ii} & =\sum_{n=1}^{N}\frac{\left(\Lambda_{i}q'_{n}\right)^{2}}{\Lambda_{i}q_{n}+\Lambda_{j}q_{n}(d)}\nonumber \\
I_{ij} & =\sum_{n=1}^{N}\frac{\Lambda_{i}\Lambda_{j}q'_{n}q'_{n}(d)}{\Lambda_{i}q_{n}+\Lambda_{j}q_{n}(d)} & \text{ for \ensuremath{i\neq j}}\label{eq:Fisher Information Static}
\end{alignat}

\end_inset

where 
\begin_inset Formula $q_{n}(d)=\int_{C_{n}}q(x-d)dx$
\end_inset

 (
\begin_inset Formula $q_{n}(0)=q_{n})$
\end_inset

 and 
\begin_inset Formula $q_{n}'(d)=\int_{C_{n}}\frac{\partial q(x-d)}{\partial x}dx$
\end_inset

 (
\begin_inset Formula $q'_{n}(0)=q'_{n})$
\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
\begin_inset Wrap figure
lines 0
placement o
overhang 0col%
width "50col%"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sized]{
\backslash
homepath 
\backslash
qdotspath /T1/images/LogLikelihoodSurface}
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
Log-likelihood surface
\begin_inset CommandInset label
LatexCommand label
name "fig:Log-likelihood-surface"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

As shown in Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Appendix An-alternative-way-Fisher-info"

\end_inset

 variance defined in Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:variance d alternative"

\end_inset

 have very reasonable behaviour in the limits: the limit 
\begin_inset Formula $d\rightarrow0$
\end_inset

 gives the variance 
\begin_inset Formula $\text{var}(d)\rightarrow\infty$
\end_inset

 for any value 
\begin_inset Formula $\Lambda_{i}$
\end_inset

, 
\begin_inset Formula $\Lambda_{j}$
\end_inset

.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
The log-likelihood Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:FREM likekihood Poisson"

\end_inset

 as a function of 
\begin_inset Formula $(c_{1},\, c_{2})$
\end_inset

 is shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Log-likelihood-surface"

\end_inset

.
 The surface creats a flat crest along the line 
\begin_inset Formula $c_{1}=c_{2}$
\end_inset

 The curviture of 
\begin_inset Formula $\mathcal{L}$
\end_inset

 is zero along this direction which yields zero Fisher information
\end_layout

\end_inset

.
 The variance is also infinite if one of the sources is zero 
\begin_inset Formula $\Lambda_{i}=0$
\end_inset

 as it does not make any assumption about the symmetry with respect to the
 origin (
\begin_inset Formula $d=c_{1}-c_{2}$
\end_inset

).
 
\end_layout

\begin_layout Standard
For sources well separated 
\begin_inset Formula $d\rightarrow\infty$
\end_inset

 the off-diagonal elements of the Fisher information matrix vanishes (
\begin_inset Formula $I_{ij}=0\text{ for }i\neq j$
\end_inset

) and the variance becomes 
\begin_inset Formula $\text{var}(d)=\text{var}(c_{1})+\text{var}(c_{2})$
\end_inset

 (sum of the variances for localisation of individual sources).
\end_layout

\begin_layout Subsection
FREM for blinking sources
\end_layout

\begin_layout Standard
One of the fundamental questions is whether the fluorescence intermittancy
 (QD blinking) allows for higher resolution compared to the situation when
 the sources remains static over time.
 To address this question we assume a simple model of Poisson distributed
 data with mean values 
\begin_inset Formula $\lambda_{n}$
\end_inset

 shown in Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Mean value of hte Poisson process"

\end_inset

.
 We assume the intensity vector of the two sources 
\begin_inset Formula $\bm{\Lambda}=(\Lambda_{1},\Lambda_{2})$
\end_inset

 to be a random variable distributed over four distinctive states 
\begin_inset Formula $\left\{ \bm{\Lambda}^{1}=(\Lambda_{1},0),\,\bm{\Lambda}^{2}=(0,\Lambda_{2}),\,\bm{\Lambda}^{3}=(\Lambda_{1},\Lambda_{2}),\,\bm{\Lambda}^{4}=(0,0)\right\} $
\end_inset

.
 This simulates a simple blinking model of two QDs.
 
\end_layout

\begin_layout Standard
If we knew what state is the 
\begin_inset Formula $\bm{\Lambda}$
\end_inset

 in we would write the likelihood function as 
\begin_inset Formula 
\[
l(\theta)=p(n,\bm{\Lambda}|\theta)=\prod_{p=1}^{N}\prod_{i=1}^{4}p(n_{p}|\theta,\bm{\Lambda}^{i})p(\bm{\Lambda}^{i})
\]

\end_inset

and the Fisher information matrix would become (Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Appendix: Time-distribution - Cheating"

\end_inset

)
\end_layout

\begin_layout Standard

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula 
\begin{equation}
I(\theta)=\sum_{i=1}^{4}p(\bm{\Lambda}_{i})\sum_{p=1}^{N}\frac{1}{\lambda_{p}(\theta,\bm{\Lambda}_{i})}\left(\frac{\partial\lambda_{p}(\theta,\bm{\Lambda}_{i})}{\partial\theta}\right)^{2}\label{eq:Fisher Information Blinking Cheating}
\end{equation}

\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
which is the expectation value (with respect to the states 
\begin_inset Formula $\bm{\Lambda}$
\end_inset

) of the Fisher information matrix Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Information Static"

\end_inset

.
 
\end_layout

\begin_layout Standard
However, we assume we do not know what state is the variable 
\begin_inset Formula $\bm{\Lambda}$
\end_inset

 in and so we have to integrate the 
\begin_inset Formula $\bm{\Lambda}$
\end_inset

 out.
 The likelihood function is then 
\begin_inset Formula 
\begin{equation}
l(\theta)=\prod_{p=1}^{N}p(n_{p}|\theta)=\prod_{p=1}^{N}\sum_{i=1}^{4}p(n_{p},\bm{\Lambda}^{i}|\theta)=\prod_{p=1}^{N}\sum_{i=1}^{4}p(n_{p}|\theta,\bm{\Lambda}^{i})p(\bm{\Lambda}^{i})\label{eq:FREM likelihood Lanbda integrated out}
\end{equation}

\end_inset

This complicates the evaluation of the Fisher information matrix Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher information general"

\end_inset

 because of the summation within the logarithm in the log-likelihood 
\begin_inset Formula 
\[
\mathcal{L}(\theta)=\log l(\theta)=\sum_{p}\log\sum_{i=1}^{4}p(n_{p}|\theta,\bm{\Lambda}^{i})p(\bm{\Lambda}^{i})
\]

\end_inset

In Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Appendix Time-distribution-Integrating out"

\end_inset

 we show that the Fisher information matrix for 
\begin_inset Formula $p(\bm{\Lambda}^{i})=\frac{1}{4}$
\end_inset

 for all 
\begin_inset Formula $i$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat}{1}
I_{rs}(\theta) & =\sum_{p=1}^{N}\mathbb{E}_{p}\left[\frac{\left(\sum_{i=1}^{4}\frac{\partial\textrm{Po}(\textrm{\lambda}_{p}^{i})}{\partial c_{r}}\right)\left(\sum_{l=1}^{4}\frac{\partial\textrm{Po}(\textrm{\lambda}_{p}^{l})}{\partial c_{s}}\right)}{\left(\sum_{j=1}^{4}\textrm{Po}(\lambda_{p}^{j})\right)^{2}}\right]\label{eq:Fisher Information Blinking Integrating Out}
\end{alignat}

\end_inset

where 
\begin_inset Formula $\lambda_{p}^{i}=\lambda_{p}(\bm{\Lambda}^{i})$
\end_inset

 is the mean intensity in the 
\begin_inset Formula $p$
\end_inset

th pixel when 
\begin_inset Formula $\bm{\Lambda}$
\end_inset

 is in the state 
\begin_inset Formula $\bm{\Lambda}^{i}$
\end_inset

 and 
\begin_inset Formula $\mathbb{E}_{p}\left[.\right]$
\end_inset

 represents the expectation value with respect to 
\begin_inset Formula $p(n_{p}|\theta)$
\end_inset

 in Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:FREM likelihood Lanbda integrated out"

\end_inset

.
 Expressing the derivatives and the expectation value gives
\begin_inset Formula 
\[
I_{rs}(\theta)=\frac{1}{2}\sum_{p=1}^{N}\left(\frac{\partial\lambda_{p}^{r}}{\partial c_{r}}\right)\left(\frac{\partial\lambda_{p}^{s}}{\partial c_{s}}\right)\sum_{n_{p}\geq0}\left[\frac{\left(\sum_{i=\{r,3\}}\mathrm{Po}(n_{p};\lambda_{p}^{i})\frac{(n_{p}-\lambda_{p}^{i})}{\lambda_{p}^{i}}\right)\left(\sum_{i=\{s,3\}}\mathrm{Po}(n_{p};\lambda_{p}^{i})\frac{(n_{p}-\lambda_{p}^{i})}{\lambda_{p}^{i}}\right)}{\sum_{j=1}^{4}\textrm{Po}(n_{p};\lambda_{p}^{j})}\right]
\]

\end_inset

In Appendix
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Appendix Time-distribution-Integrating out"

\end_inset

 we show that the limit 
\begin_inset Formula $d\rightarrow0$
\end_inset

 gives 
\begin_inset Formula $\text{var}(d)\rightarrow\infty$
\end_inset

 and the limit 
\begin_inset Formula $d\rightarrow\infty$
\end_inset

 gives 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\text{var}(d)=\frac{1}{I_{11}}+\frac{1}{I_{22}}=2\left(\frac{1}{I_{11}^{\text{static}}-\epsilon}+\frac{1}{I_{22}^{\text{static}}-\epsilon}\right)>2\text{var}(d^{\text{static}})$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 where 
\begin_inset Formula $I^{\text{static}}$
\end_inset

 and 
\begin_inset Formula $\text{var}^{\text{static}}(d)$
\end_inset

 is the Fisher information matrix and the variance, respectively, of the
 static case (section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:An-alternative-derivation-FREM"

\end_inset

).
 The factor 2 in the expression for the variance comes from the fact that
 the total number of photons in this model is the factor of two smaller
 then in the static case.
\end_layout

\begin_layout Subsection
Simulations
\end_layout

\begin_layout Standard
We made a numerical computation of the 
\begin_inset Formula $\text{var}(d)$
\end_inset

 for two sources with equal intensity 
\begin_inset Formula $\Lambda_{1}=\Lambda_{2}=\Lambda$
\end_inset

.
 The parameters of teh simulatd sources are shown in Tab.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Parameters-of-the-simulation"

\end_inset

.
 We kept the total intensity (total photon count) equal for both static
 and the blinking case.
 
\end_layout

\begin_layout Standard
In the static case Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:variance d alternative"

\end_inset

 the variance 
\begin_inset Formula $\text{var}(d)\propto\frac{1}{\Lambda}$
\end_inset

 as each entry of the Fisher information matrix 
\begin_inset Formula $I_{pq}\propto\Lambda$
\end_inset

 (Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Information Static"

\end_inset

).
 The intensity of the sources 
\begin_inset Formula $\Lambda$
\end_inset

 is only a linear scaling factor.
 In the blinking case Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Information Blinking Integrating Out"

\end_inset

 the dependency on 
\begin_inset Formula $\Lambda$
\end_inset

 is complicated as the expectation in Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Information Blinking Integrating Out"

\end_inset

 cannot be easily evaluated.
 The results for different values of 
\begin_inset Formula $\Lambda$
\end_inset

 are shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Comparison Fisher-informaton and variance"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=.5]{
\backslash
homepath 
\backslash
qdotspath /T1/images/ComarisonStaticVsBlinking_FisherInfo}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Fisher Information matrix
\begin_inset CommandInset label
LatexCommand label
name "fig:Fisher-Information-matrix"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=.5]{
\backslash
homepath 
\backslash
qdotspath /T1/images/ComarisonStaticVsBlinking_var}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset Formula $\text{var}(d)$
\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:variance d"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Left: Fisher informaton matrix entries.
 Solid lined show diagonal entries, broken line show the off-diagonal elements.
 Right: variance of the distance estimation.
 Black lines show the results for the static case Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Information Static"

\end_inset

.
 Color lines show the blinking situation Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Information Blinking Integrating Out"

\end_inset

 for different intensities 
\begin_inset Formula $\Lambda$
\end_inset

 of the sources.
 The values must be scaled by a factor 
\begin_inset Formula $\alpha$
\end_inset

 shown in the legend.
 The vertical broken line indicates the Rayleigh resolution limit.
 
\begin_inset CommandInset label
LatexCommand label
name "fig:Comparison Fisher-informaton and variance"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
make simulation when most of the time is one on and the other off - not
 equal probabilities over the four states
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Conclusions
\end_layout

\begin_layout Standard
The alternative derivation of the FREM provides correction to the formula
 published in 
\begin_inset CommandInset citation
LatexCommand cite
key "Ram2006a"

\end_inset

.
 Results presented in the Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Comparison Fisher-informaton and variance"

\end_inset

 suggest that the intensity blinking of the sources can increase the localisatio
n precision for the situations when the sources are very close.
 However, for well separated sources (
\begin_inset Formula $d\rightarrow\infty$
\end_inset

 limit) the static situation provide upper bound for the eintries of the
 Fisher information matrix of blinking model (Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:variance d static vs blinking"

\end_inset

) In this configuration the static situation allows for more precise localisatio
n.
 The intersection points of the curves for static and blinking model depends
 on the intensity of the sources (Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:variance d"

\end_inset

).
 
\end_layout

\begin_layout Standard
The results here, however, are computed for the model with no background.
 More investigation will be needed to explore the effect of the background.
 
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Out of focus PSF
\end_layout

\begin_layout Standard
\begin_inset Wrap figure
lines 0
placement O
overhang 0in
width "50col%"
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /Users/ondrejmandula/DTC/annualreport/images/PSF/psf_profiles_invitrogen.jpg
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Point spread function for different focal planes.
 www.invitrogen.com
\begin_inset CommandInset label
LatexCommand label
name "fig:Point-spread-function"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The point spread function (PSF) is a rather complicated 3D object.
 A scan along the axial direction throug a PSF of an optical microcope (Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Point-spread-function"

\end_inset

) shows characteristic ringings for out-of-focus PSF.
 In a real biological sample PSF from different focal planes can overlap.
 As the NMF does not make any assumption about the PSFs of the individual
 sources (parameter matrix 
\begin_inset Formula $W$
\end_inset

), it is possible to separate ovelapping QDs located in different axial
 positions.
 This can be possible used for the 3D localisation of the sources.
 Moreover the PSF of the individual sources can differ due to the aberrations
 caused by imperfections of the microcope or by inhomogenities of the refractive
 index in the sample.
 However, the PSF of each source must remain constant during the data acquisitio
n.
 
\end_layout

\begin_layout Subsection
Results
\end_layout

\begin_layout Standard
We recorded a sample of the QDs deposited on a cover slip.
 Slight variations in the focal plane occures between individual QDs which
 provides differrent PSF for individual sources.
 We acquired 
\begin_inset Formula $10^{3}$
\end_inset

 images with 
\begin_inset Formula $100\,\text{ms}$
\end_inset

 exposure time (the total acquisition time is about 2
\begin_inset space ~
\end_inset

mins).
 Several images from the time stack are shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Out of focus QDs"

\end_inset

.
 The PCA coefficients of the data are shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Out of focus QDs - PCA"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizec]{
\backslash
homepath 
\backslash
qdotspath /S279/images/d1}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizec]{
\backslash
homepath 
\backslash
qdotspath /S279/images/d2}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizec]{
\backslash
homepath 
\backslash
qdotspath /S279/images/d3}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizec]{
\backslash
homepath 
\backslash
qdotspath /S279/images/d4} 
\end_layout

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\begin_layout Plain Layout


\backslash

\backslash

\end_layout

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizec]{
\backslash
homepath 
\backslash
qdotspath /S279/images/d5}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizec]{
\backslash
homepath 
\backslash
qdotspath /S279/images/d6}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizec]{
\backslash
homepath 
\backslash
qdotspath /S279/images/d7}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizec]{
\backslash
homepath 
\backslash
qdotspath /S279/images/d8}
\end_layout

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Eight images (out of 
\begin_inset Formula $10^{3}$
\end_inset

) of the blinking QD time series.
\begin_inset CommandInset label
LatexCommand label
name "fig:Out of focus QDs"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

We used a standard NMF algorithm 
\begin_inset CommandInset citation
LatexCommand cite
key "Lee2001"

\end_inset

 with different number of sources 
\begin_inset Formula $K=\{7,\,8\,...\,19\}$
\end_inset

 and computed maximum correlation coefficient of the residuals 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Correlation in residuals"

\end_inset

.
 The results are shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Out of focus QDs - Correlations"

\end_inset

.
 Unlike the PCA (Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Out of focus QDs - PCA"

\end_inset

) we can observe a 'kink' in for 
\begin_inset Formula $K=13$
\end_inset

.
 Increasing 
\begin_inset Formula $K$
\end_inset

 does not lead to a further decrease of the correlations in residuals.
 Separated individual PSF (
\begin_inset Formula $W$
\end_inset

) for 
\begin_inset Formula $K=13$
\end_inset

 are shown in Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Out of focus QD - Separated-sources"

\end_inset

.
 The separated individual PSFs correspond to QDs at different axial positions
 (see Fig.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Point-spread-function"

\end_inset

).
 
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\lang english
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\lang english
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\lang english
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=.5]{
\backslash
homepath 
\backslash
qdotspath /S281/images/pca}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\lang english
\begin_inset Caption

\begin_layout Plain Layout

\lang english
PCA
\begin_inset CommandInset label
LatexCommand label
name "fig:Out of focus QDs - PCA"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=.5]{
\backslash
homepath 
\backslash
qdotspath /S281/images/MaxCorrInResid_min}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\lang english
\begin_inset Caption

\begin_layout Plain Layout

\lang english
Correlations
\begin_inset CommandInset label
LatexCommand label
name "fig:Out of focus QDs - Correlations"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\lang english
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Estimation of K
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=1.38]{
\backslash
homepath 
\backslash
qdotspath /S279/images/dpixcmean}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Mean intensity image
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S281/images/resw_col1}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S281/images/resw_col2}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S281/images/resw_col3}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S281/images/resw_col4}
\end_layout

\begin_layout Plain Layout


\backslash
includegraphics[scale=
\backslash
sizeb]{
\backslash
homepath 
\backslash
qdotspath /S281/images/resw_col5}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Separated sources
\begin_inset CommandInset label
LatexCommand label
name "fig:Out of focus QD - Separated-sources"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{centering}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Left: mean intensity image correspond to a standard wide-field image.
 Right: separated individual sources for 
\begin_inset Formula $K=13$
\end_inset

.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Conclusion and future work
\end_layout

\begin_layout Subsection
Comparison to the Richardson Lucy deconvolution
\end_layout

\begin_layout Subsection
Time series
\end_layout

\begin_layout Standard
Standard NMF does not require any prior knowledge about the matrices 
\begin_inset Formula $W$
\end_inset

 or 
\begin_inset Formula $H$
\end_inset

, apart from the non-negativity constraints.
 We can use a permutation operator to the data for the indices along the
 time (
\begin_inset Formula $\pi_{x}(x)$
\end_inset

) or the space (
\begin_inset Formula $\pi_{t}(t)$
\end_inset

) dimension without changing the permuted factorised matrices
\begin_inset Formula 
\[
V_{\pi_{x}(x)\pi_{t}(t)}=\sum_{k=1}^{K}W_{\pi_{x}(x)k}H_{k\pi_{t}(t)}
\]

\end_inset

However, there can be a rich information contained in the time-series nature
 of the data.
 The sources intensities matrix can be highly correlated along the time
 dimension - the sources that are ON at one time are likely to be ON in
 the following time instant.
 
\end_layout

\begin_layout Standard
Molgedey Schuster 
\begin_inset CommandInset citation
LatexCommand cite
key "Molgedey1994a"

\end_inset


\end_layout

\begin_layout Standard
Direction of the future work.
 Experimental work.
 Publications (?).
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "references/MachineLearning,references/Microscopy,references/QuantumDots,references/Books"
options "apalike"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
\start_of_appendix
NMF as a minimisation of Kullback–Leibler divergence
\begin_inset CommandInset label
LatexCommand label
name "sec:Appendix NMF-as-minimization"

\end_inset


\end_layout

\begin_layout Standard
A generalised Kullback-Liebler (KL) divergence between two (un normalised)
 discrete variables 
\begin_inset Formula $P_{i}$
\end_inset

 and 
\begin_inset Formula $Q_{i}$
\end_inset

 is defined
\begin_inset Formula 
\[
KL(P\parallel Q)=\sum_{i}\left(Q_{i}\log\frac{Q_{i}}{P_{i}}-Q_{i}+P_{i}\right)
\]

\end_inset

NMF algorithm 
\begin_inset CommandInset citation
LatexCommand cite
key "Lee2001"

\end_inset

 minimised the KL divergence between the data matrix 
\begin_inset Formula $D$
\end_inset

 and the factorised model 
\begin_inset Formula $WH$
\end_inset

 (Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:NMF model"

\end_inset

)
\begin_inset Formula 
\begin{equation}
\min_{W,H\geq0}KL(D\Vert WH)=\min_{W,H\geq0}-\sum_{xt}\left(d_{xt}\log\sum_{k=1}^{K}w_{xk}h_{kt}-\sum_{k=1}^{K}w_{xk}h_{kt}\right)+C\label{eq:Appendix KL(D|WH)}
\end{equation}

\end_inset

where 
\begin_inset Formula $C$
\end_inset

 is a constant independent on 
\begin_inset Formula $W$
\end_inset

 and 
\begin_inset Formula $H$
\end_inset

.
 
\end_layout

\begin_layout Standard
Log-likelihood function of the model Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:NMF model"

\end_inset

 under an assumption of Poisson noise 
\begin_inset Formula 
\[
\log p(D|W,H)=\sum_{x,t}\log\left(\frac{d_{xt}^{\sum_{k}w_{xk}h_{kt}}e^{-\sum_{k}w_{xk}h_{kt}}}{d_{xt}!}\right)=\sum_{xt}\left(d_{xt}\log\sum_{k=1}^{K}w_{xk}h_{kt}-\sum_{k=1}^{K}w_{xk}h_{kt}\right)+D
\]

\end_inset

where 
\begin_inset Formula $D$
\end_inset

 is a constant independent on 
\begin_inset Formula $W$
\end_inset

 and 
\begin_inset Formula $H$
\end_inset

.
 Comparison with Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Appendix KL(D|WH)"

\end_inset

 shows that minimisation of the KL divergence between data and the model
 is equivalent to the maximisation of the log-likelihood function of the
 model with assumption of the Poisson noise.
 
\end_layout

\begin_layout Section
Variational approximation for GaP model
\begin_inset CommandInset label
LatexCommand label
name "sec:Appendix Variational-approximation-for"

\end_inset


\end_layout

\begin_layout Standard
This is a derivation of the variational approximation of the GaP model 
\begin_inset CommandInset citation
LatexCommand cite
key "Buntine2006"

\end_inset

.
 From the main text there is a different notation: data 
\begin_inset Formula $d\rightarrow w$
\end_inset

, hidden variables (intensities) 
\begin_inset Formula $h\rightarrow l$
\end_inset

, parameters of the model (PSFs of the individual sources) 
\begin_inset Formula $w\rightarrow\theta$
\end_inset

.
 
\end_layout

\begin_layout Standard
Gamma-Poisson (GP) model 
\begin_inset CommandInset citation
LatexCommand cite
key "Canny2004"

\end_inset

:
\begin_inset Formula 
\[
\mathbb{E}_{w\sim p(w|l,\theta)}\left[w_{j}\right]=\sum_{k=1}^{K}\theta_{jk}l_{k}
\]

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $w_{j}$
\end_inset

 word count of 
\begin_inset Formula $j$
\end_inset

th word in a document 
\begin_inset Formula 
\[
w_{j}\sim\mathrm{Po}(w_{j};(\mathbf{\theta l})_{j})=\frac{(\mathbf{\theta l})_{j}^{w_{j}}\exp(-(\mathbf{\theta l})_{j})}{w_{h}!}
\]

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $l_{k}$
\end_inset

 component scores (vector 
\begin_inset Formula $\mathbf{l}$
\end_inset

) that indicate amount of the component in the document 
\begin_inset Formula 
\[
l_{k}\sim\mathrm{Gamma}(l_{k};\alpha_{k},\beta_{k})=\frac{l_{k}^{\alpha_{k}-1}\beta_{k}^{\alpha_{k}}\exp(-\beta_{k}l_{k})}{\Gamma(\alpha_{k})}
\]

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $\mathbf{\theta}$
\end_inset

 component loading matrix of size 
\begin_inset Formula $J\times K$
\end_inset

.
 
\begin_inset Formula $\theta_{jk}$
\end_inset

 controls partition of the 
\begin_inset Formula $k$
\end_inset

th component in the 
\begin_inset Formula $j$
\end_inset

th word
\end_layout

\begin_layout Standard
The log-likelihood of this model:
\begin_inset Formula 
\begin{alignat}{1}
\log p(\mathbf{w},l|\mathbf{\theta,}\mathrm{GP,K}) & =\sum_{k=1}^{K}\left\{ \alpha_{k}\log(\beta_{k})+(\alpha_{k}-1)\log l_{k}-\beta_{k}l_{k}-\log\Gamma(\alpha_{k})+\sum_{j=1}^{J}\left[w_{j}\log(\mathbf{\theta l})_{j}-(\mathbf{\theta l})_{j}-\log w_{j}!\right]\right\} \label{eq:likelihood l}\\
 & =\sum_{k=1}^{K}\textrm{log likelihood of}\ l_{k}+\sum_{j=1}^{J}\textrm{log likelihood of}\ w_{j}\ \textrm{given}\ \mathbf{l}\nonumber 
\end{alignat}

\end_inset


\end_layout

\begin_layout Subsection
Components assignment for words.
\begin_inset CommandInset label
LatexCommand label
name "sub:Components-assignment-for"

\end_inset

 
\end_layout

\begin_layout Standard
Introducing a discrete latent vector 
\begin_inset Formula $\mathbf{c}$
\end_inset

 whose total count is 
\begin_inset Formula $\sum_{j}w_{j}$
\end_inset

.
 The count 
\begin_inset Formula $c_{k}$
\end_inset

 gives the count of words in the document appearing in the 
\begin_inset Formula $k$
\end_inset

th component.
 It is derived from a latent matrix 
\begin_inset Formula $\mathbf{V}$
\end_inset

 of size 
\begin_inset Formula $J\times K$
\end_inset

 (entries 
\begin_inset Formula $v_{jk}$
\end_inset

).
 
\begin_inset Formula 
\begin{alignat*}{1}
\sum_{j=1}^{J}v_{jk} & =c_{k}\\
\sum_{k=1}^{K}v_{jk} & =w_{j}
\end{alignat*}

\end_inset


\end_layout

\begin_layout Standard
The distribution underlying the GP model now becomes 
\begin_inset Formula 
\begin{alignat*}{1}
l_{k} & \sim\mathrm{Gamma}(l_{k};\alpha_{k},\beta_{k})\\
c_{k} & \sim\mathrm{Po}(c_{k};l_{k})\\
v_{j,k} & \sim\mathrm{Multinom}(v_{jk};\theta_{jk},c_{k})=c_{k}!\prod_{j}\frac{\theta_{jk}^{v_{jk}}}{v_{jk}!}
\end{alignat*}

\end_inset


\end_layout

\begin_layout Standard
Proof:
\end_layout

\begin_layout Standard
We have 
\begin_inset Formula $p(c_{k}|l_{k})=\mathrm{Po}(c_{k};l_{k})$
\end_inset

 and 
\begin_inset Formula $p(v_{jk}|c_{k})=\mathrm{Binom}(v_{jk};\theta_{jk},c_{k})=\binom{c_{k}}{v_{jk}}\theta_{jk}^{v_{jk}}(1-\theta_{jk})^{c_{k}-v_{jk}}$
\end_inset

 (probability of having 
\begin_inset Formula $v_{jk}$
\end_inset

 counts in 
\begin_inset Formula $c_{k}$
\end_inset

 counts).
 Then:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{2}
p(v_{jk}|l_{k}) & =\sum_{c_{k}}p(v_{jk}|c_{k})p(c_{k}|l_{k})\\
 & =\sum_{c_{k}=v_{jk}}^{\infty}\frac{c_{k}!}{v_{jk}!(c_{k}-v_{jk})!}\theta_{jk}^{v_{jk}}(1-\theta_{jk})^{c_{k}-v_{jk}}\times\frac{l_{k}^{c_{k}}\exp(-l_{k})}{c_{k}!}\\
 & =\frac{\exp(-l_{k})\theta_{jk}^{v_{jk}}}{v_{jk}!}\sum_{c_{k}=v_{jk}}^{\infty}\frac{l_{k}^{c_{k}}(1-\theta_{jk})^{c_{k}-v_{jk}}}{(c_{k}-v_{jk})!} & |\alpha_{jk}=c_{k}-v_{jk}\\
 & =\frac{\exp(-l_{k})(\theta_{jk}l_{k})^{v_{jk}}}{v_{jk}!}\sum_{\alpha_{jk}=0}^{\infty}\frac{(l_{k}-\theta_{jk}l_{k})^{\alpha_{jk}}}{(\alpha_{jk})!}\\
 & =\frac{\exp(-l_{k})(\theta_{jk}l_{k})^{v_{jk}}}{v_{jk}!}\exp(l_{k}-\theta_{jk}l_{k})\\
 & =\frac{(\theta_{jk}l_{k})^{v_{jk}}\exp(-\theta_{jk}l_{k})}{v_{jk}!}
\end{alignat*}

\end_inset


\end_layout

\begin_layout Standard
and so 
\begin_inset Formula $p(v_{jk}|l_{k})\sim\mathrm{Po}(v_{jk};\theta_{jk}l_{k})$
\end_inset

.
\end_layout

\begin_layout Standard
Now sum of two independent Poisson distributed variables 
\begin_inset Formula $Z=X_{1}+X_{2}$
\end_inset

 (
\begin_inset Formula $X_{i}\sim\mathrm{\mathrm{Po}}(x;\lambda_{i})$
\end_inset

)is Poisson distributed:
\begin_inset Formula 
\begin{alignat*}{1}
p(Z) & =\sum_{x_{1}=0}^{z}p(X_{1})p(Z-X_{1})\\
 & =\sum_{x_{1}=0}^{z}\frac{\lambda_{1}^{x_{1}}e^{-\lambda_{1}}}{x_{1}!}\frac{\lambda_{2}^{z-x_{1}}e^{-\lambda_{2}}}{(z-x_{1})!}\\
 & =\frac{e^{-(\lambda_{1}+\lambda_{2})}}{z!}\sum_{x_{1}=0}^{z}\frac{z!}{x_{1}!(z-x_{1})!}\lambda_{1}^{x_{1}}\lambda_{2}^{z-x_{1}}\\
 & =\frac{(\lambda_{1}+\lambda_{2})^{z}e^{-(\lambda_{1}+\lambda_{2})}}{z!}
\end{alignat*}

\end_inset

for more by induction.
 
\end_layout

\begin_layout Standard
So 
\begin_inset Formula $w_{j}=\sum_{k=1}^{K}v_{jk}$
\end_inset

 is Poisson distributed:
\begin_inset Formula 
\[
w_{j}\sim\mathrm{Po}(w_{j};\sum_{k=1}^{K}\theta_{jk}l_{k})
\]

\end_inset


\end_layout

\begin_layout Standard
The joint distribution for 
\begin_inset Formula $v_{jk}$
\end_inset

 (each is Poisson):
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{2}
p(v_{1,k},v_{2,k}...v_{J,k}|l_{k},\theta_{jk}) & =\prod_{j=1}^{J}\frac{(\theta_{jk}l_{k})^{v_{jk}}\exp(-\theta_{jk}l_{k})}{v_{jk}!}\\
 & =e^{-l_{k}\sum_{j}\theta_{jk}}l_{k}^{\sum_{j}v_{jk}}\prod_{j}\frac{\theta{}^{v_{jk}}}{v_{jk}!} & |\sum_{j}\theta_{jk}=1,\sum_{j}v_{jk}=c_{k}\\
 & =\frac{l_{k}^{c_{k}}e^{-l_{k}}}{c_{k}!}c_{k}!\prod_{j}\frac{\theta{}^{v_{jk}}}{v_{jk}!}\\
 & =\mathrm{Po}(c_{k};l_{k})\times\mathrm{Multinom}(v_{jk};\theta_{jk},c_{k})
\end{alignat*}

\end_inset


\end_layout

\begin_layout Standard
The likelihood of GaP model with latent matrix 
\begin_inset Formula $V$
\end_inset

 is then 
\begin_inset Formula 
\begin{alignat*}{1}
p(V,l|\alpha,\beta,\theta,K) & =\prod_{k}p(l_{k}|\alpha_{k},\beta_{k})\prod_{jk}p(v_{1k},v_{2k}...v_{J,k}|l_{k},\theta_{jk})\\
 & =\prod_{k}\mathrm{Gamma}(l_{k};\alpha_{k},\beta_{k})\prod_{jk}\mathrm{Po}(c_{k};l_{k})\times\mathrm{Multinom}(v_{jk};\theta_{jk},c_{k})
\end{alignat*}

\end_inset


\end_layout

\begin_layout Standard
explicitly:
\begin_inset Formula 
\begin{equation}
p(V,l|\alpha,\beta,\theta,K)=\prod_{k}\frac{\beta_{k}^{\alpha_{k}}l_{k}^{c_{k}+\alpha_{k}-1}\exp(-(\beta_{k}+1)l_{k})}{\Gamma(\alpha_{k})}\prod_{jk}\frac{\theta_{jk}^{v_{jk}}}{v_{jk}!}\label{eq:likelihood V,l}
\end{equation}

\end_inset

 and 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{multline}
\log p(V,l|\alpha,\beta,\theta,K)=\sum_{k}\left\{ (c_{k}+\alpha_{k}-1)\log l_{k}-(\beta_{k}+1)l_{k}+\alpha_{k}\log\beta_{k}-\log\Gamma(\alpha_{k})+\sum_{j}\left[v_{jk}\log\theta_{jk}-\log v_{jk}!\right]\right\} \label{eq:log-likelihood V,l}
\end{multline}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $w_{j}$
\end_inset

 is derived from 
\begin_inset Formula $V$
\end_inset

 so it is not represented.
 
\end_layout

\begin_layout Standard
It is possible to integrate out 
\begin_inset Formula $l$
\end_inset

 (not sure about discrete values...?):
\begin_inset Formula 
\begin{alignat*}{1}
p(V|\alpha,\beta,\theta,K) & =\int_{0}^{\infty}p(V,l|\alpha,\beta,\theta,K)dl\\
 & =\prod_{jk}\frac{\theta_{jk}^{v_{jk}}}{v_{jk}!}\prod_{k}\frac{\beta_{k}}{\Gamma(\alpha_{k})}\int_{0}^{\infty}\left[l_{k}^{c_{k}+\alpha_{k}-1}\exp(-(\beta_{k}+1)l_{k})\right]dl_{k}
\end{alignat*}

\end_inset

and 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{2}
\int_{0}^{\infty}\left[l_{k}^{c_{k}+\alpha_{k}-1}\exp(-(\beta_{k}+1)l_{k})\right]dl_{k} & =\int_{0}^{\infty}l_{k}^{z-1}\exp(-(\beta_{k}+1)l_{k})dl_{k} & |c_{k}+\alpha_{k}=z\\
 & =\frac{1}{\left(\beta_{k}+1\right)^{z}}\int_{0}^{\infty}t^{z-1}\exp(-t)dt & |(\beta_{k}+1)l_{k}=t\\
 & =\frac{1}{\left(\beta_{k}+1\right)^{z}}\Gamma(z)
\end{alignat*}

\end_inset

so 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
p(V|\alpha,\beta,\theta,K)=\prod_{k}\frac{\beta_{k}}{\left(\beta_{k}+1\right)^{c_{k}+\alpha_{k}}}\frac{\Gamma(c_{k}+\alpha_{k})}{\Gamma(\alpha_{k})}\prod_{jk}\frac{\theta_{jk}^{v_{jk}}}{v_{jk}!}
\]

\end_inset


\end_layout

\begin_layout Subsection
EM algorithm
\end_layout

\begin_layout Standard
The term 
\begin_inset Formula $l_{k}^{(c_{k}+\alpha_{k}-1)}=l_{k}^{(\sum_{j}v_{jk}+\alpha_{k}-1)}$
\end_inset

 in Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:likelihood V,l"

\end_inset

 links together 
\begin_inset Formula $l_{k}$
\end_inset

 and 
\begin_inset Formula $V$
\end_inset

 and prevents simple evaluation of 
\begin_inset Formula $\mathcal{Q}(\theta,\theta^{\mathrm{old}})=\mathbb{E}_{p(V,l|\theta^{\mathrm{old}})}\left[\log p(V,l|\theta,...)\right]$
\end_inset

 in the EM algorithm because of the term 
\begin_inset Formula $\mathbb{E}_{p(V,l|\theta^{\mathrm{old}})}\left[v_{jk}\right]$
\end_inset

.
 It comes from the Poisson term 
\begin_inset Formula $\mathrm{Po}(c_{k};l_{k})$
\end_inset

 in 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none

\begin_inset Formula $p(V,l|\alpha,\beta,\theta,K)$
\end_inset

.
\end_layout

\begin_layout Standard
In the likelihood Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:likelihood l"

\end_inset

 is problematic the term 
\begin_inset Formula $w_{k}\log\sum_{k}\theta_{jk}l_{k}$
\end_inset

.
 (In 
\begin_inset CommandInset citation
LatexCommand cite
key "Canny2004"

\end_inset

 is the term 
\begin_inset Formula $\mathbb{E}_{l}\left[\log\sum_{k}\theta_{jk}l_{k}\right]$
\end_inset

 approximated by 
\begin_inset Formula $\log\mathbb{E}_{l}\left[\sum_{k}\theta_{jk}l_{k}\right]$
\end_inset

 which might be quite crude.)
\end_layout

\begin_layout Subsection
Variational Approximation
\begin_inset CommandInset label
LatexCommand label
name "sub:Variational-Approximation"

\end_inset


\end_layout

\begin_layout Standard
Factorised approximate posterior distribution for latent variables:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
p(l,V|w,\alpha,\beta,\theta,K)\approx q(l,V)=q_{l}(l)q_{V}(V)
\]

\end_inset

Optimal solution 
\begin_inset CommandInset citation
LatexCommand cite
key "Bishop2006"

\end_inset

 (p.466 Eq.
 (10.9))
\begin_inset Formula 
\begin{alignat}{1}
\log q_{l}^{*}(l) & =\mathbb{E}_{V\sim q_{V}}\left[\log p(V,l,w|\theta,\alpha,\beta)\right]+\mathrm{const}\label{eq:optimal q(l)}\\
\log q_{V}^{*}(V) & =\mathbb{E}_{l\sim q_{l}}\left[\log p(V,l,w|\theta,\alpha,\beta)\right]+\mathrm{const}\label{eq:optimal q(V)}
\end{alignat}

\end_inset


\end_layout

\begin_layout Standard
The lower bound is given by 
\begin_inset CommandInset citation
LatexCommand cite
key "Bishop2006"

\end_inset

 (p.465 Eq.
 (10.3))
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\mathcal{L}(q,\theta)=\sum_{z}q(Z)\log\frac{p(X,Z|\theta)}{q(Z)}=\sum_{z}q(Z)\log p(X,Z|\theta)+H(q_{l})+H(q_{V})
\]

\end_inset

where
\begin_inset Formula 
\begin{alignat*}{1}
H(q_{l}) & =-\mathbb{E}_{l\sim q_{l}}\left[\log q_{l}\right]\\
H(q_{V}) & =-\mathbb{E}_{V\sim q_{V}}\left[\log q_{V}\right]
\end{alignat*}

\end_inset

 are the entropy terms.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\log p(w|\theta,\alpha,\beta,K)\geq\mathbb{E}_{l,V\sim q(l,V)}\left[\log p(l,V,w|\theta,\alpha,\beta,K)\right]+C\label{eq:lower bound}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The functional form of the complete likelihood suggests
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat}{1}
q_{l}(l) & =\prod_{k}\mathrm{Gamma}(l_{l};\alpha_{k},\beta_{k})=\prod_{k}\frac{l_{k}^{a_{k}-1}b_{k}^{a_{k}}\exp(-b_{k}l_{k})}{\Gamma(a_{k})}\label{eq:q(l)}\\
q_{V}(V) & =\prod_{jk}\mathrm{Mutlinom}(v_{jk};n_{jk},w_{j})=\prod_{jk}\frac{w_{j}!}{v_{jk}!}n_{jk}^{v_{jk}}\label{eq:q(V)}
\end{alignat}

\end_inset

with 
\begin_inset Formula $\sum_{k}n_{jk}=1$
\end_inset

.
\end_layout

\begin_layout Standard
Then from Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:optimal q(l)"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:q(l)"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:log-likelihood V,l"

\end_inset

 keeping terms dependent on 
\begin_inset Formula $l$
\end_inset


\begin_inset Formula 
\[
(a_{k}-1)\log l_{k}-b_{k}l_{k}+\mathrm{const}=(\sum_{j}\mathbb{E}_{V}\left[v_{jk}\right]+\alpha_{k}-1)\log l_{k}-(\beta_{k}+1)l_{k}+\mathrm{const}
\]

\end_inset

where 
\begin_inset Formula $c_{k}=\sum_{j}v_{jk}$
\end_inset

.
 Form Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:optimal q(V)"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:q(V)"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:log-likelihood V,l"

\end_inset

 keeping terms dependent on 
\begin_inset Formula $V$
\end_inset


\begin_inset Formula 
\[
v_{jk}\log n_{jk}-\log v_{jk}!+\mathrm{const}=v_{jk}\mathbb{E}_{l}\left[\log l_{k}\right]+v_{jk}\log\theta_{jk}-\log v_{jk}!+\mathrm{const}
\]

\end_inset

so the rewrite rules for the parameters:
\begin_inset Formula 
\begin{alignat}{1}
n_{jk} & =\frac{1}{z_{j}}\theta_{jk}\exp(\mathbb{E}_{l}\left[\log l_{k}\right])\nonumber \\
a_{k} & =\sum_{j}n_{jk}w_{j}+\alpha_{k}\label{eq:rewrite rules}\\
b_{k} & =1+\beta_{k}\nonumber 
\end{alignat}

\end_inset

where 
\begin_inset Formula $z_{j}$
\end_inset

 is the normalisation constant (
\begin_inset Formula $\sum_{k}n_{jk}=1$
\end_inset

) so 
\begin_inset Formula $z_{j}=\sum_{k}\theta_{jk}\exp(\mathbb{E}_{l}\left[\log l_{k}\right])$
\end_inset

 and 
\begin_inset Formula $\sum_{j}\mathbb{E}_{V}\left[v_{jk}\right]=\sum_{j}n_{jk}w_{j}$
\end_inset

 (Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:q(V)"

\end_inset

).
 
\begin_inset Formula $\mathbb{E}_{l\sim q_{l}}\left[\log l_{k}\right]=\psi_{0}(a_{k})-\log b_{k}$
\end_inset

 where 
\begin_inset Formula $\psi_{0}$
\end_inset

 is digamma function (logarithmic derivation of the gamma function) and
 so 
\begin_inset Formula 
\[
n_{jk}=\frac{1}{z_{j}}\theta_{jk}\exp(\psi_{0}(a_{k})-\log b_{k})
\]

\end_inset

 
\end_layout

\begin_layout Standard
Now recompute model parameter 
\begin_inset Formula $\mathbf{\theta}$
\end_inset

 by maximising lower bound Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:lower bound"

\end_inset

 (with constraints 
\begin_inset Formula $\sum_{j}\theta_{jk}=1$
\end_inset

).
 Keeping only term dependent on 
\begin_inset Formula $\theta_{jk}$
\end_inset

:
\begin_inset Formula 
\begin{alignat*}{1}
\mathcal{L}(\theta) & =\sum_{j,k}\mathbb{E}_{q_{V}(V)}\left[v_{jk}\right]\log\theta_{jk}+\mathrm{const}\\
 & =\sum_{j,k}n_{jk}w_{j}\log\theta_{jk}+\mathrm{const}
\end{alignat*}

\end_inset

(from Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:q(V)"

\end_inset

 
\begin_inset Formula $\mathbb{E}_{q_{V}(V)}\left[v_{jk}\right]=w_{j}n_{jk}$
\end_inset

) 
\begin_inset Formula 
\[
0=\frac{\partial}{\partial\theta_{mn}}\left[\sum_{j,k}n_{jk}w_{j}\log\theta_{jk}+\lambda_{k}(1-\sum_{p}\theta_{pk})\right]
\]

\end_inset

we get 
\begin_inset Formula 
\[
\theta_{mn}=\frac{n_{mn}w_{m}}{\lambda_{n}}
\]

\end_inset

and from normalisation constraints 
\begin_inset Formula $\lambda_{n}=\sum_{m}n_{mn}w_{m}$
\end_inset

.
\end_layout

\begin_layout Standard
If we take likelihood function over all documents (
\begin_inset Formula $i=1:L$
\end_inset

) each 
\begin_inset Formula $w_{j}\rightarrow w_{j(i)}$
\end_inset

 and 
\begin_inset Formula $n_{jk}\rightarrow n_{jk(i)}$
\end_inset

 then we get 
\begin_inset Formula 
\begin{equation}
\theta_{mn}=\frac{\sum_{i}n_{mn(i)}w_{m(i)}}{\lambda_{n}}\label{eq:update theta}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Buntine 
\begin_inset CommandInset citation
LatexCommand cite
key "Buntine2006"

\end_inset

 even introduce prior on 
\begin_inset Formula $\theta_{jk}\sim\mathrm{Dirichlet(\theta_{jk};\gamma,J)=C(\gamma_{j})\prod_{j=1}^{J}\theta_{jk}^{\gamma_{j}-1}}$
\end_inset

.
 This is incorporated into the complete log-likelihood function 
\begin_inset Formula $p(V,l,w,\theta|\alpha,\beta,K)$
\end_inset

 so that lower bound 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none

\begin_inset Formula $\mathbb{E}_{l,V\sim q(l,V)}\left[\log p(l,V,w,\theta|\alpha,\beta,K)\right]$
\end_inset

 and terms dependent on 
\begin_inset Formula $\theta$
\end_inset

:
\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit

\begin_inset Formula 
\begin{alignat*}{1}
\mathcal{L}(\theta) & =\sum_{i,j,k}\mathbb{E}_{q_{V}(V)}\left[v_{jk(i)}\right]\log\theta_{jk}+(\gamma_{j}-1)\log\theta_{jk}+\mathrm{const}\\
 & =(\sum_{i,j,k}n_{jk(i)}w_{j(i)}+\gamma_{j}-1)\log\theta_{jk}+\mathrm{const}
\end{alignat*}

\end_inset

and by maximising with normalisation constraints:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\theta_{mn}\propto\sum_{i}n_{mn(i)}w_{m(i)}+\gamma_{j}\label{eq:update theta - prior}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The lower bound Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:lower bound"

\end_inset


\begin_inset Formula 
\begin{alignat*}{1}
\mathcal{L}(\theta) & =\mathbb{E}_{l,V\sim q(l,V)}\left[\sum_{k}(c_{k}+\alpha_{k}-1)\log l_{k}-(\beta_{k}+1)l_{k}+\log\frac{\beta_{k}^{\alpha_{k}}}{\Gamma(\alpha_{k})}+\sum_{j}\left[v_{jk}\log\theta_{jk}-\log v_{jk}!\right]\right]+C\\
 & =\sum_{k}\mathbb{E}_{l}\left[\log l_{k}\right](\sum_{j}\mathbb{E}_{V}\left[v_{jk}\right]+\alpha_{k}-1)-(\beta_{k}+1)l_{k}+\log\frac{\beta_{k}^{\alpha_{k}}}{\Gamma(\alpha_{k})}\\
 & +\sum_{j}\left[\mathbb{E}_{V}\left[v_{jk}\right]\left(\log n_{jk}+\log z_{j}-\mathbb{E}_{l}\left[\log l_{k}\right]-\mathbb{E}_{V}\left[\log v_{jk}!\right]\right)\right]+C\\
 & =\sum_{k}\mathbb{E}_{l}\left[\log l_{k}\right](\alpha_{k}-1)-(\beta_{k}+1)l_{k}+\log\frac{\beta_{k}^{\alpha_{k}}}{\Gamma(\alpha_{k})}+\sum_{j}\left[\mathbb{E}_{V}\left[v_{jk}\right]\left(\log n_{jk}+\log z_{j}-\log v_{jk}!\right)\right]+C
\end{alignat*}

\end_inset

where Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:rewrite rules"

\end_inset

 for 
\begin_inset Formula $\theta$
\end_inset

 was used and 
\begin_inset Formula $c_{k}=\sum_{j}v_{jk}$
\end_inset

 and where 
\begin_inset Formula $C=H(q_{l})+H(q_{V})$
\end_inset

 from Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:lower bound"

\end_inset

:
\begin_inset Formula 
\begin{alignat*}{1}
H(q_{l}) & =-\sum_{k}\left\{ (a_{k}-1)\mathbb{E}_{l}\left[\log l_{k}\right]-b_{k}\mathbb{E}_{l}\left[l_{k}\right]-\log\frac{b_{k}^{a_{k}}}{\Gamma(a_{k})}\right\} \\
H(q_{V}) & =-\sum_{jk}\left\{ -\mathbb{E}_{V}\left[\log v_{jk}!\right]+\mathbb{E}_{V}\left[v_{jk}\right]\log n_{jk}+\log w_{j}!\right\} 
\end{alignat*}

\end_inset

Including these terms we get 
\begin_inset Formula 
\begin{equation}
\mathcal{L}=\sum_{k}\mathbb{E}_{l}\left[\log l_{k}\right](\alpha_{k}-a_{k})+\sum_{j}w_{j}\log z_{j}+\sum_{k}\log\frac{\Gamma(a_{k})\beta_{k}^{\alpha_{k}}}{\Gamma(\alpha_{k})b_{k}^{a_{k}}}-\log\prod_{j}w_{j}!\label{eq:lower bound final}
\end{equation}

\end_inset

where Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:rewrite rules"

\end_inset

 for 
\begin_inset Formula $b_{k}$
\end_inset

 and 
\begin_inset Formula $\sum_{k}n_{jk}=1$
\end_inset

 was used.
 
\end_layout

\begin_layout Standard
After initialisation the algorithm then repeats until convergence:
\end_layout

\begin_layout Enumerate
For each document: update 
\begin_inset Formula $n_{jk}$
\end_inset

 and 
\begin_inset Formula $a_{k}$
\end_inset

 according to Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:rewrite rules"

\end_inset

 (variational E step).
\end_layout

\begin_layout Enumerate
Update 
\begin_inset Formula $\mathbf{\theta}$
\end_inset

 according to Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:update theta"

\end_inset

 or 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:update theta - prior"

\end_inset

 (variational M step).
\end_layout

\begin_layout Enumerate
Compute lower bound on log-probability Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:lower bound final"

\end_inset

 and check for convergence.
\end_layout

\begin_layout Section*
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Subsection
Notes
\end_layout

\begin_layout Standard
Image of the digamma function 
\begin_inset Formula $\psi_{0}(x)$
\end_inset

 and its exponential 
\begin_inset Formula $\exp(\psi_{0}(x))$
\end_inset

 (pretty much linear 
\begin_inset Formula $\exp(\psi_{0}(x))\approx x$
\end_inset

 for 
\begin_inset Formula $x>10$
\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../DCA_BuntineJakulin/images/psi.eps
	scale 40

\end_inset


\begin_inset Graphics
	filename ../DCA_BuntineJakulin/images/exppsi.eps
	scale 40

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Digamma function and its expontntial.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
In my notation:
\begin_inset Formula 
\[
\mathbb{E}_{v\sim p(v|w,h)}\left[v_{j}\right]=\sum_{k=1}^{K}w_{jk}h_{k}
\]

\end_inset

where 
\begin_inset Formula $V_{ji}$
\end_inset

 is data matrix (
\begin_inset Formula $J$
\end_inset

 pixels and 
\begin_inset Formula $I$
\end_inset

 images), 
\begin_inset Formula $w_{jk}$
\end_inset

 is loading matrix (PSFs) (
\begin_inset Formula $J$
\end_inset

 pixels and 
\begin_inset Formula $K$
\end_inset

 components) and 
\begin_inset Formula $h_{ki}$
\end_inset

 are intensities of each component (
\begin_inset Formula $K$
\end_inset

 components and 
\begin_inset Formula $I$
\end_inset

 images).
\end_layout

\begin_layout Standard
Rewrite rules:
\begin_inset Formula 
\begin{alignat*}{1}
n_{jk(i)} & =\frac{1}{z_{j}}w_{jk}\exp(\psi_{0}(a_{k(i)})-\log b_{k(i)})\\
a_{k(i)} & =\sum_{j}n_{jk(i)}v_{j(i)}+\alpha_{k}\\
b_{k(i)} & =1+\beta_{k}
\end{alignat*}

\end_inset

and 
\begin_inset Formula 
\[
w_{jk}=\frac{\sum_{i}n_{jk(i)}v_{j(i)}}{\lambda_{j}}
\]

\end_inset


\end_layout

\begin_layout Standard
The lower bound on the log-likelihood:
\begin_inset Formula 
\[
\mathcal{L}_{(i)}=\sum_{k}\left(\psi_{0}(a_{k(i)})-\log b_{k(i)}\right)\left(\alpha_{k}-a_{k(i)}\right)+\sum_{j}v_{j(i)}\log z_{j(i)}+\sum_{k}\log\frac{\Gamma(a_{k(i)})\beta_{k}^{\alpha_{k}}}{\Gamma(\alpha_{k})b_{k(i)}^{a_{k(i)}}}-\log\prod_{j}v_{j(i)}!
\]

\end_inset

where 
\begin_inset Formula $z_{j(i)}=\sum_{k}w_{jk}\exp\left(\psi_{0}(a_{k(i)})-\log b_{k(i)}\right)$
\end_inset

 and total lower bound 
\begin_inset Formula $\mathcal{L}=\sum_{i}\mathcal{L}_{(i)}$
\end_inset

.
\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename ../DCA_BuntineJakulin/images/GammaDistribution2.eps
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
Gamma distribution for different set of parameters with mean 
\begin_inset Formula $\alpha/\beta=700$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Section
Resolution limit for the blinking QDs
\end_layout

\begin_layout Subsection
Poisson random variable
\end_layout

\begin_layout Standard
This is derivation of the fisher information for Poisson distributed variable
 
\begin_inset Formula $X$
\end_inset

 with mean 
\begin_inset Formula $\lambda$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
X\sim\textrm{Po}(n,\lambda)=p(n|\theta)=\frac{\lambda^{n}e^{-\lambda}}{n!}
\]

\end_inset

Likelihood of the Poisson distributed variable with detection 
\begin_inset Formula $n_{k}$
\end_inset

 in K pixels: 
\begin_inset Formula 
\begin{equation}
l(\theta)=\prod_{k=1}^{K}l_{k}=\prod_{k=1}^{K}\frac{\lambda_{k}^{n_{k}}e^{-\lambda_{k}}}{n_{k}!}\label{eq:Likelihood of Poisson}
\end{equation}

\end_inset

where 
\begin_inset Formula $l_{k}(\theta)=p(n_{k}|\theta)$
\end_inset

 to emphasise the dependency on the parameter 
\begin_inset Formula $\theta$
\end_inset

.
\end_layout

\begin_layout Standard
Log-Likelihood:
\begin_inset Formula 
\[
\mathcal{L}=\sum_{k}\left(n_{k}\log\lambda_{k}-\lambda_{k}-\log n_{k}!\right)
\]

\end_inset


\end_layout

\begin_layout Subsection
Fisher Information for a Poisson variable
\begin_inset CommandInset label
LatexCommand label
name "sub: Appendix Fisher-Information-Poisson"

\end_inset


\end_layout

\begin_layout Standard
Fisher information:
\begin_inset Formula 
\begin{equation}
I(\theta)=-\mathbb{E}\left[\frac{\partial^{2}\mathcal{L}}{\partial\theta^{2}}\right]=\mathbb{E}\left[\left(\frac{\partial\mathcal{L}}{\partial\theta}\right)^{2}\right]=\mathbb{E}\left[\left(\sum_{k}\frac{\partial\log(l_{k})}{\partial\theta}\right)^{2}\right]=\mathbb{E}\left[\left(\sum_{k}\frac{1}{l_{k}}\frac{\partial l_{k}}{\partial\theta}\right)^{2}\right]\label{eq:Fisher Info Definition}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{1}
I(\theta) & =\mathbb{E}\left[\left(\sum_{k}\frac{1}{l_{k}}\frac{\partial l_{k}}{\partial\theta}\right)\left(\sum_{m}\frac{1}{l_{m}}\frac{\partial l_{m}}{\partial\theta}\right)\right]\\
 & =\mathbb{E}\left[\sum_{k}\frac{1}{l_{k}^{2}}\left(\frac{\partial l_{k}}{\partial\theta}\right)^{2}\right]+\mathbb{E}\left[\sum_{k}\sum_{m\neq k}\frac{1}{l_{k}}\frac{\partial l_{k}}{\partial\theta}\frac{1}{l_{m}}\frac{\partial l_{m}}{\partial\theta}\right]
\end{alignat*}

\end_inset

as 
\begin_inset Formula $n_{k}$
\end_inset

 are iid then the second term can be expressed as 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\mathbb{E}\left[\sum_{k}\sum_{m\neq k}\frac{1}{l_{k}}\frac{\partial l_{k}}{\partial\theta}\frac{1}{l_{m}}\frac{\partial l_{m}}{\partial\theta}\right] & =\sum_{k}\sum_{m\neq k}\mathbb{E}_{k}\left[\frac{1}{l_{k}}\frac{\partial l_{k}}{\partial\theta}\right]\mathbb{E}_{m}\left[\frac{1}{l_{m}}\frac{\partial l_{m}}{\partial\theta}\right]
\end{align*}

\end_inset

where
\begin_inset Formula 
\[
\mathbb{E}_{k}\left[f(n_{k})\right]=\sum_{n_{k}\geq0}p(n_{k}|\theta)f(n_{k})
\]

\end_inset

But 
\begin_inset Formula 
\[
\mathbb{E}_{k}\left[\frac{1}{l_{k}}\frac{\partial l_{k}}{\partial\theta}\right]=\sum_{n_{k}}l_{k}\frac{1}{l_{k}}\frac{\partial l_{k}}{\partial\theta}=\sum_{n_{k}}\frac{\partial l_{k}}{\partial\theta}=\frac{\partial\sum_{n_{k}}l_{k}}{\partial\theta}=0
\]

\end_inset

as 
\begin_inset Formula $\sum_{n_{k}}l_{k}=\sum_{n_{k}}p(n_{k}|\theta)=1$
\end_inset

.
 The Fisher Information can then be expressed 
\begin_inset Formula 
\begin{align*}
I(\theta) & =\mathbb{E}\left[\sum_{k}\frac{1}{l_{k}^{2}}\left(\frac{\partial l_{k}}{\partial\theta}\right)^{2}\right]\\
 & =\sum_{k=1}^{k}\sum_{n_{k}\geq0}l_{k}\frac{1}{l_{k}^{2}}\left(\frac{\partial l_{k}}{\partial\theta}\right)^{2}\\
 & =\sum_{k=1}^{k}\sum_{n_{k}\geq0}\frac{1}{l_{k}}\left(\frac{\partial l_{k}}{\partial\theta}\right)^{2}
\end{align*}

\end_inset

Derivatives of likelihood Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Likelihood of Poisson"

\end_inset

: 
\begin_inset Formula 
\[
\frac{\partial l_{k}}{\partial\theta}=\frac{l_{k}(n_{k}-\lambda_{k})}{\lambda_{k}}\frac{\partial\lambda_{k}}{\partial\theta}
\]

\end_inset

And we get:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
I(\theta) & =\sum_{k=1}^{k}\sum_{n_{k}\geq0}\frac{l_{k}(n_{k}-\lambda_{k})^{2}}{\lambda_{k}^{2}}\left(\frac{\partial\lambda_{k}}{\partial\theta}\right)^{2}\\
 & =\sum_{k=1}^{k}\frac{1}{\lambda_{k}^{2}}\left(\frac{\partial\lambda_{k}}{\partial\theta}\right)^{2}\mathbb{E}_{k}\left[(n_{k}-\lambda_{k})^{2}\right]
\end{align*}

\end_inset

for Poisson 
\begin_inset Formula $\mathrm{var}(n)=\mathrm{mean}(n)=\lambda$
\end_inset

 gives 
\begin_inset Formula 
\[
\mathbb{E}_{k}\left[(n_{k}-\lambda_{k})^{2}\right]=\textrm{var}(n_{k})=\lambda_{k}
\]

\end_inset

and 
\begin_inset Formula 
\begin{equation}
I(\theta)=\sum_{k=1}^{K}\frac{1}{\lambda_{k}}\left(\frac{\partial\lambda_{k}}{\partial\theta}\right)^{2}\label{eq:Fisher Info for Poisson}
\end{equation}

\end_inset

This is the pixelised version (detection of the photons in K detectors -
 CCD camera and 
\begin_inset Formula $\lambda_{k}=\int_{C_{k}}\lambda(x)dx$
\end_inset

 where 
\begin_inset Formula $C_{k}$
\end_inset

 is an area of the pixels of the detector).
 
\end_layout

\begin_layout Standard
Non pixelised version 
\begin_inset CommandInset citation
LatexCommand cite
key "Ram2006"

\end_inset

s
\begin_inset Formula 
\[
I(\theta)=\int\frac{1}{\lambda(x)}\left(\frac{\partial\lambda(x)}{\partial\theta}\right)^{2}dx
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Subsection
Two sources separated by a distance 
\begin_inset Formula $d$
\end_inset


\begin_inset CommandInset label
LatexCommand label
name "sub:Appendix Two-sources-separated"

\end_inset


\end_layout

\begin_layout Standard
These are comment on Fisher Information estimation as described in 
\begin_inset CommandInset citation
LatexCommand cite
key "Ram2006"

\end_inset

.
\end_layout

\begin_layout Standard
For two sources separated by a distance 
\begin_inset Formula $d$
\end_inset

 we have a mean value of the intensity:
\begin_inset Formula 
\[
\lambda=\Lambda_{1}f_{1}+\Lambda_{2}f_{2}
\]

\end_inset

 where 
\begin_inset Formula $f_{i}$
\end_inset

 and 
\begin_inset Formula $\Lambda_{i}$
\end_inset

 is the response function and intensity, respectively, of the source 
\begin_inset Formula $i$
\end_inset

.
 For translationally invariant PSF and in-focus sources: 
\begin_inset Formula $f_{1}=q(x-\frac{d}{2})$
\end_inset

 and 
\begin_inset Formula $f_{2}=q(x+\frac{d}{2})$
\end_inset

 
\begin_inset Formula 
\[
\lambda(d)=\Lambda_{1}q(x-\frac{d}{2})+\Lambda_{2}q(x+\frac{d}{2})
\]

\end_inset

where 
\begin_inset Formula $q$
\end_inset

 is the PSF of the sources.
 For pixelised version (integral over pixel area 
\begin_inset Formula $C_{k}$
\end_inset

)
\begin_inset Formula 
\[
\lambda_{k}(d)=\Lambda_{1}\int_{C_{k}}q(x-\frac{d}{2})dx+\Lambda_{2}\int_{C_{k}}q(x+\frac{d}{2})dx
\]

\end_inset

so we get (as described in
\begin_inset CommandInset citation
LatexCommand citet
key "Ram2006"

\end_inset

)
\begin_inset Formula 
\begin{equation}
I(d)=\frac{1}{4}\sum_{k=1}^{K}\frac{\left(\Lambda_{1}\int_{C_{k}}\partial_{x}q(x-\frac{d}{2})dx-\Lambda_{2}\int_{C_{k}}\partial_{x}q(x+\frac{d}{2})dx\right)^{2}}{\Lambda_{1}\int_{C_{k}}q(x-\frac{d}{2})dx+\Lambda_{2}\int_{C_{k}}q(x+\frac{d}{2})dx}\label{eq:Fisher Info Pixelised - Ram}
\end{equation}

\end_inset


\end_layout

\begin_layout Subparagraph*
Limit 
\begin_inset Formula $d=0$
\end_inset


\end_layout

\begin_layout Standard
If 
\begin_inset Formula $\Lambda_{1}=\Lambda_{2}$
\end_inset

 then 
\begin_inset Formula $I(d=0)=0$
\end_inset

 which means 
\begin_inset Formula $\textrm{var}(d=0)\rightarrow\infty$
\end_inset

.
 (This does not hold for 
\begin_inset Formula $\Lambda_{1}\neq\Lambda_{2}$
\end_inset

).
 
\end_layout

\begin_layout Subparagraph*
Limit 
\begin_inset Formula $d\rightarrow\infty$
\end_inset


\end_layout

\begin_layout Standard
When sources are far apart then the mixing term in nominator in 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Info Pixelised - Ram"

\end_inset

 
\begin_inset Formula $\Lambda_{1}\Lambda_{2}\partial_{x}q(x-\frac{d}{2})\partial q(d+\frac{d}{2})=0$
\end_inset

 as the 
\begin_inset Formula $\partial_{x}q(x-\frac{d}{2})$
\end_inset

 (
\begin_inset Formula $q(x-\frac{d}{2})$
\end_inset

) and 
\begin_inset Formula $\partial_{x}q(x+\frac{d}{2})$
\end_inset

 (
\begin_inset Formula $q(x+\frac{d}{2})$
\end_inset

 ) do not have any overlap.
 The 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Info Pixelised - Ram"

\end_inset

 then decomposes into two individual terms (sum of Fisher Information for
 localisation of individual sources.) 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{1}
I(d) & =\frac{1}{4}\sum_{k=1}^{K}\left[\frac{\left(\Lambda_{1}\int_{C_{k}}\partial_{x}q(x-\frac{d}{2})dx\right)^{2}}{\Lambda_{1}\int_{C_{k}}q(x-\frac{d}{2})dx}+\frac{\left(\Lambda_{2}\int_{C_{k}}\partial_{x}q(x+\frac{d}{2})dx\right)^{2}}{\Lambda_{2}\int_{C_{k}}q(x+\frac{d}{2})dx}\right]\\
 & =\frac{1}{4}\sum_{k=1}^{K}\frac{\left(\int_{C_{k}}\partial_{x}q(x)dx\right)^{2}}{\int_{C_{k}}q(x)dx}\left[\Lambda_{1}+\Lambda_{2}\right]
\end{alignat*}

\end_inset


\end_layout

\begin_layout Subparagraph
Limit 
\begin_inset Formula $\Lambda_{i}=0$
\end_inset


\end_layout

\begin_layout Standard
If 
\begin_inset Formula $\Lambda_{1}=0$
\end_inset

 or 
\begin_inset Formula $\Lambda_{2}=0$
\end_inset

 
\begin_inset Formula $I(d)\neq0$
\end_inset

.
 So the variance is finite even if one of the sources is not present.
\end_layout

\begin_layout Subsection
An alternative way to derive Fisher information for two sources separated
 by 
\begin_inset Formula $d$
\end_inset

:
\begin_inset CommandInset label
LatexCommand label
name "sub:Appendix An-alternative-way-Fisher-info"

\end_inset


\end_layout

\begin_layout Standard
This is a suggestion how to fix the problems with limits for Fisher Information
 derived above.
 This gives infinite variance when one of the sources is no present.
 Also fix weird behaviour of the 
\begin_inset Formula $I(d)$
\end_inset

 for 
\begin_inset Formula $d=0$
\end_inset

.
 
\end_layout

\begin_layout Standard
For two sources 
\begin_inset Formula $f_{1}=q(x-c_{1})$
\end_inset

 and 
\begin_inset Formula $f_{2}=q(x-c_{2})$
\end_inset

 we have 
\begin_inset Formula $\lambda=\Lambda_{1}f_{1}+\Lambda_{2}f_{2}$
\end_inset

.
 The distance between the two sources is 
\begin_inset Formula $d=c_{1}-c_{2}$
\end_inset

.
 This is a linear combination 
\begin_inset Formula $\bm{a}^{T}\cdot\bm{c}$
\end_inset

 of the variable 
\begin_inset Formula $\bm{c}=(c_{1},c_{2})$
\end_inset

 where 
\begin_inset Formula $\bm{a}=(1,-1)$
\end_inset

.
 The variance of 
\begin_inset Formula $d$
\end_inset

 is given by 
\begin_inset Formula 
\[
\textrm{var}(d)=\textrm{var}(\bm{a}^{T}\cdot\bm{c})=\bm{a}^{T}\cdot\bm{Q}\cdot\bm{a}=Q_{11}+Q_{22}-2Q_{12}
\]

\end_inset

 where 
\begin_inset Formula $\bm{Q}$
\end_inset

 is a covariance matrix 
\begin_inset Formula $\bm{Q}=\bm{I}^{-1}(\theta)$
\end_inset

 and 
\begin_inset Formula $\bm{I}(\theta)$
\end_inset

 is the Fisher information matrix (symmetric 
\begin_inset Formula $I_{12}=I_{21}$
\end_inset

) 
\begin_inset Formula 
\[
\bm{I}(\theta)=\left(\begin{array}{cc}
I_{11} & I_{12}\\
I_{12} & I_{22}
\end{array}\right)
\]

\end_inset

given by generalisation of Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Info for Poisson"

\end_inset

 
\begin_inset Formula 
\[
I_{ij}(\theta)=\sum_{k=1}^{K}\frac{1}{\lambda_{k}}\frac{\partial\lambda_{k}}{\partial\theta_{i}}\frac{\partial\lambda_{k}}{\partial\theta_{j}}
\]

\end_inset

The covariance matrix 
\begin_inset Formula $\bm{Q}$
\end_inset

 is then 
\begin_inset Formula 
\[
\bm{Q}=\bm{I}^{-1}(\theta)=\frac{1}{I_{11}I_{12}-I_{12}^{2}}\left(\begin{array}{cc}
I_{22} & -I_{12}\\
-I_{12} & I_{11}
\end{array}\right)
\]

\end_inset

and the variance of 
\begin_inset Formula $d=c_{1}-c_{2}$
\end_inset

 
\begin_inset Formula 
\begin{equation}
\textrm{var}(d)=(1,-1)^{T}\cdot\bm{Q}\cdot(1,-1)=\frac{I_{11}+I_{22}+2I_{12}}{I_{11}I_{12}-I_{12}^{2}}\label{eq:variance alternative}
\end{equation}

\end_inset

The individual terms of the Fisher Information matrix 
\begin_inset Formula 
\[
I_{11}=\sum_{k=1}^{K}\frac{1}{\lambda_{k}}\left(\frac{\partial\lambda_{k}}{\partial c_{1}}\right)^{2}=\sum_{k=1}^{K}\frac{\left(\Lambda_{1}q'_{k}(c_{1})\right)^{2}}{\Lambda_{1}q_{k}(c_{1})+\Lambda_{2}q_{k}(c_{2})}
\]

\end_inset

where
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{2}
q_{k}(c) & =\int_{C_{k}}q(x-c)dx & ,\ (q_{k}(0)=q_{k})\\
q'_{k}(c) & =\int_{C_{k}}\frac{\partial q(x-c)}{\partial x}dx & ,\ (q'_{k}(0)=q'_{k})
\end{alignat*}

\end_inset


\begin_inset Formula 
\[
\]

\end_inset

 If this keeps translational invariance (non-pixelised version does as 
\begin_inset Formula $\int_{\mathbb{R}}g(x+c)dx=\int_{\mathbb{R}}g(x)dx$
\end_inset

) then 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
I_{11}=\sum_{k=1}^{K}\frac{\left(\Lambda_{1}q'_{k}\right)^{2}}{\Lambda_{1}q_{k}+\Lambda_{2}q_{k}(-d)}
\]

\end_inset

where 
\begin_inset Formula $d=c_{1}-c_{2}$
\end_inset

 and 
\begin_inset Formula 
\[
I_{22}=\sum_{k=1}^{K}\frac{\left(\Lambda_{2}q'_{k}\right)^{2}}{\Lambda_{2}q_{k}+\Lambda_{1}q_{k}(d)}
\]

\end_inset

For symmetrical PSF 
\begin_inset Formula $q(x-d)=q(x+d)$
\end_inset

 we have 
\begin_inset Formula 
\begin{equation}
I_{ii}=\sum_{k=1}^{K}\frac{\left(\Lambda_{i}q'_{k}\right)^{2}}{\Lambda_{i}q_{k}+\Lambda_{j}q_{k}(d)}\label{eq:Fisher Information alternative - Individual}
\end{equation}

\end_inset

And the cross term (
\begin_inset Formula $i\neq j$
\end_inset

) 
\begin_inset Formula 
\[
I_{ij}=\sum_{k=1}^{K}\frac{\Lambda_{i}\Lambda_{j}q'_{k}q'_{k}(d)}{\Lambda_{i}q_{k}+\Lambda_{j}q_{k}(d)}
\]

\end_inset


\end_layout

\begin_layout Subparagraph
Limit 
\begin_inset Formula $d\rightarrow0$
\end_inset


\end_layout

\begin_layout Standard
For 
\begin_inset Formula $d=0$
\end_inset

 we have
\begin_inset Formula 
\begin{alignat*}{1}
I_{ii} & =\frac{\Lambda_{i}^{2}}{\Lambda_{i}+\Lambda_{j}}S(0)\\
I_{ij} & =\frac{\Lambda_{i}\Lambda_{j}}{\Lambda_{i}+\Lambda_{j}}S(0)
\end{alignat*}

\end_inset

where 
\begin_inset Formula $S(d)=\sum_{k=1}^{K}\frac{\left(q'_{k}\right)^{2}}{q_{k}+q_{k}(d)}$
\end_inset

.
 
\end_layout

\begin_layout Standard
Numerator 
\begin_inset Formula $p$
\end_inset

 in Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:variance alternative"

\end_inset

 
\begin_inset Formula 
\[
p=I_{11}+I_{22}+2I_{12}=\frac{S(0)}{\Lambda_{1}+\Lambda_{2}}(\Lambda_{1}^{2}+\Lambda_{2}^{2}+2\Lambda_{1}\Lambda_{2})=\frac{S(0)}{\Lambda_{1}+\Lambda_{2}}(\Lambda_{1}+\Lambda_{2})^{2}
\]

\end_inset

 is non-zero for any 
\begin_inset Formula $\Lambda_{1},\,\Lambda_{2}$
\end_inset

.
\end_layout

\begin_layout Standard
The denominator in Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:variance alternative"

\end_inset

 
\begin_inset Formula 
\begin{eqnarray*}
r=\det\left[\bm{I}(\theta)\right]=I_{11}I_{22}-I_{12}^{2}=\frac{S^{2}(0)}{\left(\Lambda_{1}+\Lambda_{2}\right)^{2}}\left(\Lambda_{1}^{2}\Lambda_{2}^{2}-(\Lambda_{1}\Lambda_{2})^{2}\right) & \equiv & 0\ \text{for any }\Lambda_{i}
\end{eqnarray*}

\end_inset


\begin_inset Formula $\bm{I}(\theta)$
\end_inset

 is therefore a singular matrix for 
\begin_inset Formula $d=0$
\end_inset

 and inversion 
\begin_inset Formula $\bm{I}^{-1}(\theta)$
\end_inset

 does not exist.
 
\end_layout

\begin_layout Standard
However, for the limit 
\begin_inset Formula $d\rightarrow0$
\end_inset

 and 
\begin_inset Formula $p\neq0,\, r\rightarrow0$
\end_inset

 and 
\begin_inset Formula $\textrm{var}(d\rightarrow0)=\frac{p}{r}\rightarrow\infty$
\end_inset

.
 
\end_layout

\begin_layout Subparagraph*
Limit 
\begin_inset Formula $d\rightarrow\infty$
\end_inset


\end_layout

\begin_layout Standard
The cross term 
\begin_inset Formula $I_{ij}=0,\: i\neq j$
\end_inset

 and we get f
\begin_inset Formula 
\[
\textrm{var}(d)=\frac{1}{I_{11}}+\frac{1}{I_{22}}
\]

\end_inset

and 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
I_{ii}=\sum_{k=1}^{K}\frac{\left(\Lambda_{i}q_{k}'\right)^{2}}{\Lambda_{i}q_{k}+\Lambda_{j}q_{k}(d)}=\Lambda_{i}\sum_{k=1}^{K}\frac{\left(q_{k}'\right)^{2}}{q_{k}}=2\Lambda_{i}S(0)
\]

\end_inset

as the PSF 
\begin_inset Formula $q(x)$
\end_inset

 (and also 
\begin_inset Formula $q'(x)$
\end_inset

) have a finite support, if 
\begin_inset Formula $d$
\end_inset

 is big, 
\begin_inset Formula $q(x-d)$
\end_inset

 is outside the support of the 
\begin_inset Formula $q'(x)$
\end_inset

.
 They have no overlap so it doesn't have any effect in the denominator.
\end_layout

\begin_layout Standard
For non-pixelised version, 
\begin_inset Formula $\Lambda_{1}=\Lambda_{2}=\Lambda$
\end_inset

 and for Gaussian approximation of the PSF (
\begin_inset Formula $q(x-a)\propto\exp\left(-\frac{(x-a)^{2}}{2\sigma^{2}}\right)$
\end_inset

 (with 
\begin_inset Formula $\sigma=\frac{\sqrt{2}}{2\pi}\frac{\lambda}{NA}$
\end_inset

 
\begin_inset CommandInset citation
LatexCommand cite
key "Zhang2007"

\end_inset

) we have 
\begin_inset Formula $q'(x)=\frac{1}{\sigma^{2}}xq(x)$
\end_inset

 and and for 
\begin_inset Formula $\Lambda_{1}=\Lambda_{2}=\Lambda$
\end_inset

 and for Gaussian approximation of the PSF 
\begin_inset Formula $S(0)=\frac{1}{2\sigma^{2}}$
\end_inset

:
\begin_inset Formula 
\begin{alignat*}{1}
I(d\rightarrow\infty) & =\frac{\Lambda}{\sigma^{2}}\\
\textrm{var}(d\rightarrow\infty) & =\frac{\sigma^{2}}{\Lambda}
\end{alignat*}

\end_inset


\end_layout

\begin_layout Subparagraph
Limit 
\begin_inset Formula $\Lambda_{i}=0,\ \Lambda_{j}\neq0$
\end_inset


\end_layout

\begin_layout Standard
then 
\begin_inset Formula $I_{ii}\equiv0$
\end_inset

 and 
\begin_inset Formula $I_{ij}\equiv0$
\end_inset

 and so 
\begin_inset Formula $\det(\bm{I}(\theta))\equiv0$
\end_inset

, and matrix is singular.
 In the limit 
\begin_inset Formula $\Lambda_{i}\rightarrow0$
\end_inset

 the variance 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:variance alternative"

\end_inset

 
\begin_inset Formula $\textrm{var}(d)\rightarrow\infty$
\end_inset

.
 
\end_layout

\begin_layout Subsection
Time distribution of the intensities (blinking)
\begin_inset CommandInset label
LatexCommand label
name "sub:Appendix: Time-distribution - Cheating"

\end_inset


\end_layout

\begin_layout Standard
For likelihood dependent on parameter 
\begin_inset Formula $\Lambda_{t}$
\end_inset

 (T different time slices)
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
l_{T}(d,\Lambda)=\prod_{k=1}^{K}\prod_{t=1}^{T}p(n_{k}|d,\Lambda_{t})p(\Lambda_{t})
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\mathcal{L}_{T}(d,\Lambda)=\sum_{k=1}^{K}\sum_{t=1}^{T}\left[\log\left(l_{k}(d,\Lambda_{t})\right)+\log\left(p(\Lambda_{t})\right)\right]
\]

\end_inset

as 
\begin_inset Formula $p(\Lambda)$
\end_inset

 is not dependent on 
\begin_inset Formula $d$
\end_inset

 then
\begin_inset Formula 
\[
\frac{\partial^{2}\mathcal{L}_{T}(d,\Lambda)}{\partial d^{2}}=\sum_{t=1}^{T}\frac{\partial^{2}\mathcal{L}(d,\Lambda_{t})}{\partial d^{2}}
\]

\end_inset

but in the expectation equation Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Info Definition"

\end_inset

 the time dependence appears as
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{1}
I_{T}(\theta) & =-\mathbb{E}_{T}\left[\sum_{t=1}^{T}\frac{\partial^{2}\mathcal{L}(d,\Lambda_{t})}{\partial d^{2}}\right]=\sum_{t=1}^{T}-\mathbb{E}_{T}\left[\frac{\partial^{2}\mathcal{L}(d,\Lambda_{t})}{\partial d^{2}}\right]=\sum_{t=1}^{T}\mathbb{E}_{T}\left[\left(\frac{\partial\mathcal{L}(d,\Lambda_{t})}{\partial d}\right)^{2}\right]\\
 & =\sum_{t=1}^{T}\int_{\Lambda_{t}}p(\Lambda_{t})I(\theta)d\Lambda_{t}=\sum_{t,k}\int_{\Lambda_{t}}p(\Lambda_{t})\frac{1}{\lambda_{k}(\Lambda_{t})}\left(\frac{\partial\lambda_{k}(\Lambda_{t})}{\partial d}\right)^{2}d\Lambda_{t}
\end{alignat*}

\end_inset


\end_layout

\begin_layout Subsection
Time distribution of the intensities - integrating out 
\begin_inset Formula $\Lambda$
\end_inset


\begin_inset CommandInset label
LatexCommand label
name "sub:Appendix Time-distribution-Integrating out"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
l_{k}(d)=\int_{\Lambda}l_{k}(d,\Lambda)d\Lambda=\int_{\Lambda}p(n_{k}|d,\Lambda)p(\Lambda)d\Lambda
\]

\end_inset

for four state model of two sources: 
\begin_inset Formula $\left\{ (\Lambda_{1},0),(0,\Lambda_{2}),(\Lambda_{1},\Lambda_{2}),(0,0)\right\} $
\end_inset

: 
\begin_inset Formula $\lambda^{1}=\Lambda_{1}q(x-c_{1})$
\end_inset

, 
\begin_inset Formula $\lambda^{2}=\Lambda_{2}q(x-c_{2})$
\end_inset

, 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none

\begin_inset Formula $\lambda^{3}=+\Lambda_{1}q(x-c_{1})+\Lambda_{2}q(x-c_{2})$
\end_inset

, 
\begin_inset Formula $\lambda^{4}=0$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit
 with uniform distribution over these states
\begin_inset Formula 
\[
l_{k}(\theta)=\frac{1}{4}\sum_{i=1}^{4}\mathrm{Po}(\lambda_{k}^{i})
\]

\end_inset

derivatives 
\begin_inset Formula 
\[
\frac{\partial l_{k}}{\partial c_{p}}=\frac{1}{4}\sum_{i}\frac{\partial\mathrm{Po}(\lambda_{k}^{i})}{\partial c_{p}}=\frac{1}{4}\sum_{i}\left(\mathrm{Po}(\lambda_{k}^{i})\frac{(n_{k}-\lambda_{k}^{i})}{\lambda_{k}^{i}}\frac{\partial\lambda_{k}^{i}}{\partial c_{p}}\right)
\]

\end_inset

The Fisher information matrix diagonal entries:
\begin_inset Formula 
\begin{alignat}{1}
I_{pp}(\theta) & =\mathbb{E}\left[\left(\sum_{k=1}^{N}\frac{1}{l_{k}}\frac{\partial l_{k}}{\partial c_{p}}\right)^{2}\right]\nonumber \\
 & =\mathbb{E}\left[\left\{ \sum_{k=1}^{N}\left(\frac{1}{\sum_{j=1}^{4}\textrm{Po}(\lambda_{k}^{j})}\frac{\partial\sum_{i=1}^{4}\textrm{Po}(\textrm{\lambda}_{k}^{i})}{\partial c_{p}}\right)\right\} \left\{ \sum_{l=1}^{N}\left(\frac{1}{\sum_{j=1}^{4}\textrm{Po}(\lambda_{l}^{j})}\frac{\partial\sum_{i=1}^{4}\textrm{Po}(\textrm{\lambda}_{l}^{i})}{\partial c_{p}}\right)\right\} \right]\nonumber \\
 & =\sum_{k=1}^{N}\mathbb{E}_{k}\left[\frac{\left(\sum_{i=1}^{4}\frac{\partial\textrm{Po}(\textrm{\lambda}_{k}^{i})}{\partial c_{p}}\right)^{2}}{\left(\sum_{j=1}^{4}\textrm{Po}(\lambda_{k}^{j})\right)^{2}}\right]\label{eq:Fisher Info Integrated Out - diagonal entries}
\end{alignat}

\end_inset

as the cross terms (
\begin_inset Formula $k,\, l$
\end_inset

) in the sum (2nd row) are zeros: 
\begin_inset Formula 
\begin{alignat*}{1}
\mathbb{E}\left[\left(\frac{\sum_{i=1}^{4}\frac{\partial\textrm{Po}(\textrm{\lambda}_{k}^{i})}{\partial c_{p}}}{\sum_{j=1}^{4}\textrm{Po}(\lambda_{k}^{j})}\right)\left(\frac{\sum_{i=1}^{4}\frac{\partial\textrm{Po}(\textrm{\lambda}_{l}^{i})}{\partial c_{p}}}{\sum_{j=1}^{4}\textrm{Po}(\lambda_{l}^{j})}\right)\right] & =\mathbb{E}_{k}\left[\frac{\sum_{i=1}^{4}\frac{\partial\textrm{Po}(\textrm{\lambda}_{k}^{i})}{\partial c_{p}}}{\sum_{j=1}^{4}\textrm{Po}(\lambda_{k}^{j})}\right]\mathbb{E}_{l}\left[\frac{\sum_{i=1}^{4}\frac{\partial\textrm{Po}(\textrm{\lambda}_{l}^{i})}{\partial c_{p}}}{\sum_{j=1}^{4}\textrm{Po}(\lambda_{l}^{j})}\right]\\
 & =\sum_{i=1}^{4}\frac{\partial}{\partial c_{p}}\left(\sum_{n_{k}\geq0}\textrm{Po}(\textrm{\lambda}_{k}^{i})\right)\sum_{i=1}^{4}\frac{\partial}{\partial c_{p}}\left(\sum_{n_{k}\geq0}\textrm{Po}(\textrm{\lambda}_{l}^{i})\right)\\
 & =0
\end{alignat*}

\end_inset

Expressing the derivatives and the expectation from Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Info Integrated Out - diagonal entries"

\end_inset

:
\begin_inset Formula 
\begin{alignat*}{1}
I_{pp}(\theta) & =\sum_{k=1}^{N}\mathbb{E}_{k}\left[\left\{ \frac{\sum_{i=1}^{4}\left(\mathrm{Po}(n_{k};\lambda_{k}^{i})\frac{(n_{k}-\lambda_{k}^{i})}{\lambda_{k}^{i}}\frac{\partial\lambda_{k}^{i}}{\partial c_{p}}\right)}{\sum_{j=1}^{4}\textrm{Po}(n_{k};\lambda_{k}^{j})}\right\} ^{2}\right]\\
 & =\frac{1}{4}\sum_{k=1}^{N}\sum_{n_{k}\geq0}\frac{\left\{ \sum_{i=1}^{4}\left(\mathrm{Po}(n_{k};\lambda_{k}^{i})\frac{(n_{k}-\lambda_{k}^{i})}{\lambda_{k}^{i}}\frac{\partial\lambda_{k}^{i}}{\partial c_{p}}\right)\right\} ^{2}}{\sum_{j=1}^{4}\textrm{Po}(n_{k};\lambda_{k}^{j})}
\end{alignat*}

\end_inset

For the four states model we have 
\begin_inset Formula $\lambda^{3}(c_{1},c_{2})=\lambda^{1}(c_{1})+\lambda^{2}(c_{2})$
\end_inset

 and so 
\begin_inset Formula $\frac{\partial\lambda^{3}}{\partial c_{p}}=\frac{\partial\lambda^{p}}{\partial c_{p}}$
\end_inset

 and 
\begin_inset Formula $\frac{\partial\lambda^{j}}{\partial c_{p}}=0,\, i\neq j$
\end_inset

 for 
\begin_inset Formula $p=\{1,2\},\: j=\{1,2,4\};$
\end_inset

 so 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat*}{1}
I_{pp}(\theta) & =\sum_{k=1}^{N}\left(\frac{\partial\lambda_{k}^{p}}{\partial c_{p}}\right)^{2}\mathbb{E}_{k}\left[\left\{ \frac{\sum_{i=\{p,3\}}\left(\mathrm{Po}(n_{k};\lambda_{k}^{i})\frac{(n_{k}-\lambda_{k}^{i})}{\lambda_{k}^{i}}\right)}{\sum_{j=1}^{4}\textrm{Po}(n_{k};\lambda_{k}^{j})}\right\} ^{2}\right]
\end{alignat*}

\end_inset


\end_layout

\begin_layout Standard
The Fisher information matrix off-diagonal entries:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{alignat}{1}
I_{pq}(\theta) & =\sum_{k=1}^{N}\mathbb{E}_{k}\left[\frac{\left(\sum_{i=1}^{4}\frac{\partial\textrm{Po}(\textrm{\lambda}_{k}^{i})}{\partial c_{p}}\right)\left(\sum_{l=1}^{4}\frac{\partial\textrm{Po}(\textrm{\lambda}_{k}^{l})}{\partial c_{q}}\right)}{\left(\sum_{j=1}^{4}\textrm{Po}(\lambda_{k}^{j})\right)^{2}}\right]\nonumber \\
 & =\sum_{k=1}^{N}\left(\frac{\partial\lambda_{k}^{p}}{\partial c_{p}}\right)\left(\frac{\partial\lambda_{k}^{q}}{\partial c_{q}}\right)\mathbb{E}_{k}\left[\frac{\left(\sum_{i=\{p,3\}}\mathrm{Po}(n_{k};\lambda_{k}^{i})\frac{(n_{k}-\lambda_{k}^{i})}{\lambda_{k}^{i}}\right)\left(\sum_{i=\{q,3\}}\mathrm{Po}(n_{k};\lambda_{k}^{i})\frac{(n_{k}-\lambda_{k}^{i})}{\lambda_{k}^{i}}\right)}{\left(\sum_{j=1}^{4}\textrm{Po}(n_{k};\lambda_{k}^{j})\right)^{2}}\right]\label{eq:Fisher Info Integrated Out-off diagonal entries}
\end{alignat}

\end_inset


\end_layout

\begin_layout Paragraph
Limit 
\begin_inset Formula $d\rightarrow0$
\end_inset


\end_layout

\begin_layout Standard
When 
\begin_inset Formula $c^{1}=c^{2}$
\end_inset

 then 
\begin_inset Formula $\lambda^{1}=\lambda^{2}$
\end_inset

 and 
\begin_inset Formula $\frac{\partial\text{Po}(\lambda^{1})}{\partial c^{1}}=\frac{\partial\text{Po}(\lambda^{2})}{\partial c^{2}}$
\end_inset

.
 Then all entries in 
\begin_inset Formula $I_{pq}$
\end_inset

 are equal and the matrix is singular.
 For the limit 
\begin_inset Formula $d\rightarrow0$
\end_inset

 the determianat 
\begin_inset Formula $\det(\bm{I})\rightarrow0$
\end_inset

 and the variance 
\begin_inset Formula $\text{var}(d)\rightarrow\infty$
\end_inset

.
\end_layout

\begin_layout Paragraph
Limit 
\begin_inset Formula $d\rightarrow\infty$
\end_inset


\end_layout

\begin_layout Standard
Sources are far apart and 
\begin_inset Formula $\lambda^{1}$
\end_inset

 and 
\begin_inset Formula $\lambda^{2}$
\end_inset

 don not have a common overlap.
 For 
\begin_inset Formula $k'$
\end_inset

 where 
\begin_inset Formula $\lambda_{k'}^{1}>0,\,\lambda_{k'}^{2}\equiv0$
\end_inset

 and 
\begin_inset Formula $\text{Po}(n_{k'},\lambda_{k'}^{3})=\text{Po}(n_{k'},\lambda_{k'}^{1})+\text{Po}(n_{k'},\lambda_{k'}^{2}=0)=\text{Po}(n_{k'},\lambda_{k'}^{1})+1$
\end_inset

.
 Also 
\begin_inset Formula $\frac{\partial\lambda^{p}}{\partial c_{q}}=0,\: p\neq q$
\end_inset

.
 From Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Info Integrated Out - diagonal entries"

\end_inset

 the diagonal elemets 
\begin_inset Formula 
\begin{alignat*}{1}
I_{pp} & =\sum_{k=1}^{N}\mathbb{E}_{k}\left[\frac{\left(2\frac{\partial\textrm{Po}(\textrm{\lambda}_{k}^{p})}{\partial c_{p}}\right)^{2}}{\left(2\textrm{Po}(\lambda_{k}^{p})+2\textrm{Po}(\lambda_{k}^{q})\right)^{2}}\right]\\
 & =\sum_{k=1}^{N}\mathbb{E}_{k}\left[\frac{\left(\textrm{Po}(\textrm{\lambda}_{k}^{p})\frac{\left(n_{k}-\lambda_{k}^{p}\right)^{2}}{\lambda_{k}^{p}}\frac{\partial\lambda_{k}^{p}}{\partial c_{p}}\right)^{2}}{\left(\textrm{Po}(\lambda_{k}^{p})+1\right)^{2}}\right]\\
 & =\sum_{k=1}^{N}\left(\frac{1}{\lambda_{k}^{p}}\frac{\partial\textrm{\lambda}_{k}^{p}}{\partial c_{p}}\right)^{2}\mathbb{E}_{k}\left[\left(n_{k}-\lambda_{k}^{p}\right)^{2}\left(\frac{\textrm{Po}(\textrm{\lambda}_{k}^{p})}{\textrm{Po}(\textrm{\lambda}_{k}^{p})+1}\right)^{2}\right]
\end{alignat*}

\end_inset

For large 
\begin_inset Formula $\lambda_{k}^{p}$
\end_inset

 the second term in the expectation is approximately one: 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\frac{\textrm{Po}(\textrm{\lambda}_{k}^{p})}{\textrm{Po}(\textrm{\lambda}_{k}^{p})+1}=1-\frac{1}{1+\textrm{Po}(\textrm{\lambda}_{k}^{p})}\approx1$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 
\begin_inset Formula 
\begin{equation}
I_{pp}\approx\frac{1}{2}\sum_{k=1}^{N}\frac{1}{\lambda_{k}^{p}}\left(\frac{\partial\textrm{\lambda}_{k}^{p}}{\partial c_{p}}\right)^{2}\label{eq: int out - approximation d to infty}
\end{equation}

\end_inset

which is the Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Info for Poisson"

\end_inset

 (up to the factor 2).
 As the the term is upper bounded by one: 
\begin_inset Formula $\frac{\textrm{Po}(\textrm{\lambda}_{k}^{p})}{\textrm{Po}(\textrm{\lambda}_{k}^{p})+1}=1-\frac{1}{1+\textrm{Po}(\textrm{\lambda}_{k}^{p})}<1$
\end_inset

 the terms 
\begin_inset Formula $ $
\end_inset


\begin_inset Formula $I_{pp}$
\end_inset

 will be slightly smaller then the approximaton 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq: int out - approximation d to infty"

\end_inset

:
\begin_inset Formula 
\begin{equation}
I_{pp}=\frac{1}{2}\sum_{k=1}^{N}\frac{1}{\lambda_{k}^{p}}\left(\frac{\partial\textrm{\lambda}_{k}^{p}}{\partial c_{p}}\right)^{2}-\epsilon\label{eq:int out d to infty}
\end{equation}

\end_inset

and teh 
\end_layout

\begin_layout Standard
The off-diagonal entries: 
\begin_inset Formula 
\[
I_{pq}=0
\]

\end_inset

as 
\begin_inset Formula 
\[
\frac{\partial\text{Po}(\lambda^{p})}{\partial c_{p}}\frac{\partial\text{Po}(\lambda^{q})}{\partial c_{q}}=0
\]

\end_inset

 because 
\begin_inset Formula $\lambda^{p}(x)$
\end_inset

 and 
\begin_inset Formula $\lambda^{q}(x)$
\end_inset

 do not have a common support.
 Therefore
\begin_inset Formula 
\begin{alignat}{1}
\text{var}(d) & =\frac{1}{I_{11}}+\frac{1}{I_{22}}\nonumber \\
 & =2\left(\frac{1}{I_{11}^{\text{static}}-\epsilon}+\frac{1}{I_{22}^{\text{static}}-\epsilon}\right)\nonumber \\
 & >2\text{var}(d^{\text{static}})\label{eq:variance d static vs blinking}
\end{alignat}

\end_inset

where 
\begin_inset Formula $I^{\text{static}}$
\end_inset

 and 
\begin_inset Formula $\text{var}^{\text{static}}$
\end_inset

 corresopnd to the Fisher information matrix Eq.
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Fisher Info for Poisson"

\end_inset

 and the variance Eq.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:variance alternative"

\end_inset

 of the static case.
 The factor of 2 stems from the fact that the total number of photons is
 double in the static case compared to the blinking model.
 
\end_layout

\end_body
\end_document
